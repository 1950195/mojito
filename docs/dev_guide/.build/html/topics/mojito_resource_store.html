

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
     <title>Resource Store</title>
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '',
        COLLAPSE_INDEX: true,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/theme_extras.js"></script>
   </head> 

     <div class="header"><h1 class="heading"><a href="#">
          <span>Mojito</span></a></h1>
      </div>
      <div class="topnav">
        <p>
        <a class="uplink" href="../">Mojito Documentation</a>
        &#160;&#160;::&#160;&#160;
        <a href="../index.html" title="Mojito">Mojito</a>
        &#160;&#160;::&#160;&#160;
        
           <a href="mojito_npm.html">Mojito and npm Packaging</a>
        &#160;&#160;::&#160;&#160;
        
        
           <a href="mojito_hosting_container_reqs.html">Startup Requirements for Mojito in Hosting Environments</a>
        
        </p>

      </div>
      <div class="content">
   <div class="section" id="resource-store">
<h1>Resource Store<a class="headerlink" href="#resource-store" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<span id="rs-intro"></span><h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The Resource Store (RS) is the Mojito subsystem that manages metadata about
the files in your Mojito applications. Thus, it is responsible for finding
and classifying code and configuration files. When you start a Mojito
application, Mojito can find, track, and resolve versions of files in your
application, such as mojits, configuration files, binders, views, assets,
addons, etc., because of the Resource Store.</p>
<div class="section" id="intended-audience">
<span id="intro-who"></span><h3>Intended Audience<a class="headerlink" href="#intended-audience" title="Permalink to this headline">¶</a></h3>
<p>Only advanced Mojito application developers needing finer grain control over
the management of resources or to extend the functionality of the resource
store need to read this documentation.</p>
</div>
<div class="section" id="prerequisites">
<span id="id1"></span><h3>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h3>
<p>In addition to being an advanced Mojito user, you should also understand the following
before using the Resource Store:</p>
<ul class="simple">
<li><a class="reference external" href="http://yuilibrary.com/yui/docs/plugin/">YUI Plugin</a></li>
<li><a class="reference external" href="../topics/mojito_extensions.html#addons">Mojito addons</a></li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Aspect-oriented_programming">aspect-orient programming (AOP)</a></li>
</ul>
</div>
<div class="section" id="how-can-the-resource-store-help-developers">
<span id="intro-use"></span><h3>How Can the Resource Store Help Developers?<a class="headerlink" href="#how-can-the-resource-store-help-developers" title="Permalink to this headline">¶</a></h3>
<div class="section" id="reflection">
<span id="intro-how-reflection"></span><h4>Reflection<a class="headerlink" href="#reflection" title="Permalink to this headline">¶</a></h4>
<p>The Resource Store API has methods that can be used (as-is, no addons
required) to query for details about an application. For example, when you
run the commands <tt class="docutils literal"><span class="pre">mojito</span> <span class="pre">compile</span></tt> and <tt class="docutils literal"><span class="pre">mojito</span> <span class="pre">gv</span></tt>, the Resource Store API methods
<tt class="docutils literal"><span class="pre">getResources</span></tt> and <tt class="docutils literal"><span class="pre">getResourceVersions</span></tt> are called to get information
about your application.</p>
</div>
<div class="section" id="define-register-new-resource-types">
<span id="intro-how-define-types"></span><h4>Define/Register New Resource Types<a class="headerlink" href="#define-register-new-resource-types" title="Permalink to this headline">¶</a></h4>
<p>You can write custom Resource Store addons using the aspect-oriented features of
the Resource Store to define resource types. The Resource Store has aspect-oriented features
because it is implemented as an extension of
<a class="reference external" href="http://yuilibrary.com/yui/docs/base/">Y.Base</a>, and the Resource Store addons are
implemented as <a class="reference external" href="http://yuilibrary.com/yui/docs/plugin/">YUI Plugins</a>.</p>
<p>For example, you could write your own Resource Store addon so that the Mojito
command-line tool will register files and resources for your application.</p>
</div>
<div class="section" id="extend-modify-functionality-of-the-rs">
<span id="intro-how-extend"></span><h4>Extend/Modify Functionality of the Resource Store<a class="headerlink" href="#extend-modify-functionality-of-the-rs" title="Permalink to this headline">¶</a></h4>
<p>You can also write addons or create custom versions of built-in Resource Store addons to
modify how the resource store works. Your addon could map contexts to
<a class="reference internal" href="#resolution-selectors"><em>selectors</em></a>, track new file types, augment the
information that the Resource Store stores about files or code, or augment/replace the
information returned by the Resource Store.</p>
</div>
</div>
</div>
<div class="section" id="resources">
<span id="rs-resources"></span><h2>Resources<a class="headerlink" href="#resources" title="Permalink to this headline">¶</a></h2>
<div class="section" id="what-is-a-resource">
<span id="resources-what"></span><h3>What is a Resource?<a class="headerlink" href="#what-is-a-resource" title="Permalink to this headline">¶</a></h3>
<p>In Mojito, the meaning of the term <strong>resource</strong> is different depending on the
context. Before we discuss the Resource Store in more detail, let&#8217;s differentiate and
define the definition of resource in the contexts of Mojito and the Resource Store.</p>
<div class="section" id="to-mojito">
<span id="what-to-mojito"></span><h4>To Mojito<a class="headerlink" href="#to-mojito" title="Permalink to this headline">¶</a></h4>
<p>The Mojito framework primarily views a <strong>resource</strong> as something useful found
on the filesystem.</p>
</div>
<div class="section" id="to-the-resource-store">
<span id="what-to-rs"></span><h4>To the Resource Store<a class="headerlink" href="#to-the-resource-store" title="Permalink to this headline">¶</a></h4>
<p>The Resource Store primarily cares about the <em>metadata</em> about each resource, so it
sees the metadata as the <em>resource</em>.  To the Resource Store, the <strong>resource</strong> is just
a JavaScript object containing metadata.  The Resource Store defines certain keys with
specific meanings.  The Resource Store addons can add, remove, or modify those
keys/values as they see fit.  For example, the YUI Resource Store addon adds, for
resources that are YUI modules, the <tt class="docutils literal"><span class="pre">yui</span></tt> property with metadata about
the YUI module aspect of the resource. The Resource Store itself, however, doesn&#8217;t
populate the <tt class="docutils literal"><span class="pre">yui</span></tt> key of each resource.</p>
</div>
</div>
<div class="section" id="resource-versions">
<span id="resources-versions"></span><h3>Resource Versions<a class="headerlink" href="#resource-versions" title="Permalink to this headline">¶</a></h3>
<p>Because there can be multiple files that are all conceptually different
versions of the same thing (e.g., <tt class="docutils literal"><span class="pre">views/index.hb.html</span></tt> and
<tt class="docutils literal"><span class="pre">views/index.iphone.hb.html</span></tt>), the Resource Store defines <strong>resource version</strong>
as the metadata about each file and resource as the metadata about the file
chosen among the possible choices.</p>
<p>The process of choosing which version of a resource to use is called
<em>resolution</em> (or &#8220;resolving the resource&#8221;).  This act is one of the
primary responsibilities of the Resource Store.</p>
<p>See <a class="reference internal" href="#how-resolution"><em>Resolution and Priorities</em></a> to learn how the
Resource Store resolves different versions of the same resource.</p>
</div>
<div class="section" id="resource-scope">
<span id="resources-scope"></span><h3>Resource Scope<a class="headerlink" href="#resource-scope" title="Permalink to this headline">¶</a></h3>
<div class="section" id="application-level-resources">
<span id="scope-application"></span><h4>Application-Level Resources<a class="headerlink" href="#application-level-resources" title="Permalink to this headline">¶</a></h4>
<p>Application-level resources are truly global to the application.
At the application level, resources include archetypes, commands,
configuration files, and middleware.</p>
</div>
<div class="section" id="mojit-level-resources">
<span id="scope-mojit"></span><h4>Mojit-Level Resources<a class="headerlink" href="#mojit-level-resources" title="Permalink to this headline">¶</a></h4>
<p>At the mojit level, resources include controllers, models, binders,
configuration files, and views. These resources are limited in scope to a mojit.</p>
</div>
<div class="section" id="shared-resources">
<span id="scope-shared"></span><h4>Shared Resources<a class="headerlink" href="#shared-resources" title="Permalink to this headline">¶</a></h4>
<p>Some resources (and resource versions) are <em>shared</em>, meaning that they are
included in <strong>all</strong> mojits.  Most resource types that are mojit level can also
be shared.  Examples of mojit-level resource types that can&#8217;t be shared are
controllers, configuration files (such as <tt class="docutils literal"><span class="pre">definition.json</span></tt>), and YUI language
bundles.</p>
</div>
</div>
<div class="section" id="resource-types">
<span id="resources-types"></span><h3>Resource Types<a class="headerlink" href="#resource-types" title="Permalink to this headline">¶</a></h3>
<p>The resource type is defined by the <tt class="docutils literal"><span class="pre">type</span></tt> property in the metadata for a
given resource. See <a class="reference internal" href="#metadata-types"><em>Types of Resources</em></a> for descriptions
of the resource types. Developers can also create their own types of resources
to fit the need of their applications.</p>
</div>
</div>
<div class="section" id="resource-metadata">
<span id="rs-metadata"></span><h2>Resource Metadata<a class="headerlink" href="#resource-metadata" title="Permalink to this headline">¶</a></h2>
<div class="section" id="intro">
<span id="metadata-intro"></span><h3>Intro<a class="headerlink" href="#intro" title="Permalink to this headline">¶</a></h3>
<p>The Resource Store uses metadata to track information about each resource. This metadata
is used by the rest of Mojito to find, load, and parse the resources. The
metadata is generated by the Resource Store or by Resource Store addons—it has no
representation on the filesystem.</p>
</div>
<div class="section" id="metadata-object">
<span id="metadata-obj"></span><h3>Metadata Object<a class="headerlink" href="#metadata-object" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="9%" />
<col width="9%" />
<col width="13%" />
<col width="22%" />
<col width="30%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Data Type</th>
<th class="head">Required?</th>
<th class="head">Default Value</th>
<th class="head">Possible Values</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">type</span></tt></td>
<td>string</td>
<td>yes</td>
<td>none</td>
<td>See <em class="xref std std-ref">Types of Resources</em>.</td>
<td>Specifies the type of resource.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">subtype</span></tt></td>
<td>string</td>
<td>no</td>
<td>none</td>
<td>See the section
<a class="reference internal" href="#types-subtypes"><em>Subtypes</em></a></td>
<td>Some resource types have multiple subtypes
that can be specified with <tt class="docutils literal"><span class="pre">subtype</span></tt>. See
<a class="reference internal" href="#types-subtypes"><em>Subtypes</em></a> for
more information.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">name</span></tt></td>
<td>string</td>
<td>yes</td>
<td>none</td>
<td>N/A</td>
<td>The name of the resource that is common to
all versions (i.e., iPhone/Android, etc.)
of the resource. Example: the name for
for the resources <tt class="docutils literal"><span class="pre">index.iphone.hb.html</span></tt>
and <tt class="docutils literal"><span class="pre">index.hb.html</span></tt> is <tt class="docutils literal"><span class="pre">index</span></tt>.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">id</span></tt></td>
<td>string</td>
<td>yes</td>
<td>none</td>
<td>N/A</td>
<td>A unique ID that is common to all versions
of the  resource. The <tt class="docutils literal"><span class="pre">id</span></tt> has the
following syntax convention:
<tt class="docutils literal"><span class="pre">{type}-{subtype}-{name}</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">mojit</span></tt></td>
<td>string</td>
<td>no</td>
<td>none</td>
<td>N/A</td>
<td>The mojit, if any, that uses this resource
The value <tt class="docutils literal"><span class="pre">&quot;shared&quot;</span></tt> means the resource
is available to all mojits.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">affinity</span></tt></td>
<td>string</td>
<td>yes</td>
<td>See <a class="reference internal" href="#def-vals"><em>Note
About Default
Values</em></a>.</td>
<td><tt class="docutils literal"><span class="pre">server</span></tt>, <tt class="docutils literal"><span class="pre">client</span></tt>,
<tt class="docutils literal"><span class="pre">common</span></tt></td>
<td>The affinity of the resource, which
indicates where the resource will be used.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">selector</span></tt></td>
<td>string</td>
<td>no</td>
<td>&#8220;*&#8221;</td>
<td>N/A</td>
<td>The version of the resource. For example, a
resource could have a version for iPhones,
Android devices, fallbacks, etc. (This concept
of version should not to be confused code
revisions, which mark the change of something
over time.) For more info, see
<a class="reference internal" href="#sel-prop"><em>selector Property</em></a>.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#src-obj"><em>source</em></a></td>
<td>object</td>
<td>yes</td>
<td>none</td>
<td>N/A</td>
<td><p class="first">Specifies where the resource came from.
See <a class="reference internal" href="#src-obj"><em>source Object</em></a> for</p>
<blockquote class="last">
<div>details.</div></blockquote>
</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">url</span></tt></td>
<td>string</td>
<td>no</td>
<td>none</td>
<td>N/A</td>
<td>The path used to load the resource
onto the client. Used only for resources
that can be deployed by reference to the
client.</td>
</tr>
<tr class="row-odd"><td><em class="xref std std-ref">view</em></td>
<td>object</td>
<td>yes, if
<tt class="docutils literal"><span class="pre">type:view</span></tt></td>
<td>none</td>
<td>N/A</td>
<td>Specifies the output format such as HTML, XML,
JSON, etc., and the engine that renders the
template into the output format.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#yui-obj"><em>yui</em></a></td>
<td>object</td>
<td>no</td>
<td>none</td>
<td>N/A</td>
<td>The metadata about YUI modules. See the
<a class="reference internal" href="#yui-obj"><em>yui Object</em></a> for more
details.</td>
</tr>
</tbody>
</table>
<div class="admonition-note-about-default-values admonition" id="def-vals">
<p class="first admonition-title">Note About Default Values</p>
<p class="last">Some values for the properties of the metadata object do have defaults, but
it depends on the value of the <tt class="docutils literal"><span class="pre">type</span></tt> property and/or comes from the file
name of the resource being represented. For example, the affinity of views
is <tt class="docutils literal"><span class="pre">common</span></tt> (because views are used on both client and server); however,
the affinity for controllers comes from the file name, so there is no default.</p>
</div>
<div class="section" id="source-object">
<span id="src-obj"></span><h4>source Object<a class="headerlink" href="#source-object" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="11%" />
<col width="8%" />
<col width="11%" />
<col width="22%" />
<col width="32%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Data Type</th>
<th class="head">Required?</th>
<th class="head">Default Value</th>
<th class="head">Possible Values</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">fs</span></tt></td>
<td>object</td>
<td>yes</td>
<td>none</td>
<td>N/A</td>
<td>Contains the filesystem details of a
resource. See <a class="reference internal" href="#fs-obj"><em>fs Object</em></a>.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">pkg</span></tt></td>
<td>object</td>
<td>yes</td>
<td>none</td>
<td>N/A</td>
<td>Contains the <tt class="docutils literal"><span class="pre">npm</span></tt> package details of a
resource. See <a class="reference internal" href="#pkg-obj"><em>pkg Object</em></a>.</td>
</tr>
</tbody>
</table>
<div class="section" id="fs-object">
<span id="fs-obj"></span><h5>fs Object<a class="headerlink" href="#fs-object" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="16%" />
<col width="11%" />
<col width="16%" />
<col width="32%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Data Type</th>
<th class="head">Required?</th>
<th class="head">Default Value</th>
<th class="head">Possible Values</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">basename</span></tt></td>
<td>string</td>
<td>yes</td>
<td>none</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">ext</span></tt></td>
<td>string</td>
<td>yes</td>
<td>none</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">fullPath</span></tt></td>
<td>string</td>
<td>yes</td>
<td>none</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">isFile</span></tt></td>
<td>boolean</td>
<td>yes</td>
<td>none</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">rootDir</span></tt></td>
<td>string</td>
<td>yes</td>
<td>none</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">rootType</span></tt></td>
<td>string</td>
<td>yes</td>
<td>none</td>
<td>See <a class="reference internal" href="#metadata-types"><em>Types of Resources</em></a>.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">subDir</span></tt></td>
<td>string</td>
<td>yes</td>
<td>none</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">subDirArray</span></tt></td>
<td>array</td>
<td>yes</td>
<td>none</td>
<td>N/A</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="pkg-object">
<span id="pkg-obj"></span><h5>pkg Object<a class="headerlink" href="#pkg-object" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="11%" />
<col width="8%" />
<col width="11%" />
<col width="22%" />
<col width="32%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Data Type</th>
<th class="head">Required?</th>
<th class="head">Default Value</th>
<th class="head">Possible Values</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">depth</span></tt></td>
<td>number</td>
<td>yes</td>
<td>none</td>
<td>N/A</td>
<td>The depth in <tt class="docutils literal"><span class="pre">npm</span></tt> dependencies in the
<tt class="docutils literal"><span class="pre">node_modules</span></tt> directory where the package
is found.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">name</span></tt></td>
<td>string</td>
<td>yes</td>
<td>none</td>
<td>N/A</td>
<td>The name of the package in which the
resource is found.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">version</span></tt></td>
<td>string</td>
<td>yes</td>
<td>none</td>
<td>N/A</td>
<td>The version of the package.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="view-object">
<span id="view-obj"></span><h4>view Object<a class="headerlink" href="#view-object" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="10%" />
<col width="8%" />
<col width="10%" />
<col width="22%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Data Type</th>
<th class="head">Required?</th>
<th class="head">Default Value</th>
<th class="head">Possible Values</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">engine</span></tt></td>
<td>string</td>
<td>yes</td>
<td>none</td>
<td>Any view engine found
in <tt class="docutils literal"><span class="pre">addons/view-engines/</span></tt>
of the application.</td>
<td>The engine that renders the template.
Two examples of rendering engines are
Dust and Handlebars.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">outputFormat</span></tt></td>
<td>string</td>
<td>yes</td>
<td>none</td>
<td>N/A</td>
<td>The output format that a template is
rendered into, such as HTML, XML, and JSON.
The <tt class="docutils literal"><span class="pre">outputFormat</span></tt> matches the file
extension of the template. For example,
the output format for <tt class="docutils literal"><span class="pre">index.hb.html</span></tt> would
be HTML.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="yui-object">
<span id="yui-obj"></span><h4>yui Object<a class="headerlink" href="#yui-object" title="Permalink to this headline">¶</a></h4>
<p>The <tt class="docutils literal"><span class="pre">yui</span></tt> property of the <tt class="docutils literal"><span class="pre">metadata</span></tt> object is created by the <tt class="docutils literal"><span class="pre">yui</span></tt> Resource Store addon.
The <tt class="docutils literal"><span class="pre">yui</span></tt> property can be any data type, but in general, it is an object
containing metadata about YUI modules.  You can think of the <tt class="docutils literal"><span class="pre">yui</span></tt> object as
a container for the arguments to the <tt class="docutils literal"><span class="pre">YUI.add</span></tt> method that is used to register
reusable YUI modules.</p>
<p>The following table lists the typical properties that are
part of the <tt class="docutils literal"><span class="pre">yui</span></tt> object.</p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="10%" />
<col width="8%" />
<col width="10%" />
<col width="22%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Data Type</th>
<th class="head">Required?</th>
<th class="head">Default Value</th>
<th class="head">Example Values</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">name</span></tt></td>
<td>string</td>
<td>yes</td>
<td>none</td>
<td><tt class="docutils literal"><span class="pre">&quot;scroll&quot;</span></tt></td>
<td>The name of the YUI module.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">meta</span></tt></td>
<td>array</td>
<td>yes</td>
<td>none</td>
<td><tt class="docutils literal"><span class="pre">[&quot;scroll&quot;,&quot;node&quot;,&quot;cache&quot;]</span></tt></td>
<td>Contains a list of YUI modules required by
this resource. The <tt class="docutils literal"><span class="pre">meta</span></tt> object contains
the same properties as the <tt class="docutils literal"><span class="pre">details</span></tt> object
that is passed to the <a class="reference external" href="http://yuilibrary.com/yui/docs/api/classes/YUI.html#method_add">YUI add method</a>.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="types-of-resources">
<span id="metadata-types"></span><h3>Types of Resources<a class="headerlink" href="#types-of-resources" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">type</span></tt> property of the <tt class="docutils literal"><span class="pre">metadata</span></tt> object can have any of the following
values:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">config</span></tt>      - a piece of configuration, sometimes for another resource</li>
<li><tt class="docutils literal"><span class="pre">controller</span></tt>  - the controller for a mojit</li>
<li><tt class="docutils literal"><span class="pre">model</span></tt>       - a model for a mojit</li>
<li><tt class="docutils literal"><span class="pre">view</span></tt>        - a view for a mojit</li>
<li><tt class="docutils literal"><span class="pre">binder</span></tt>      - a binder for a mojit</li>
<li><tt class="docutils literal"><span class="pre">asset</span></tt>       - an asset (css, js, image, etc.)</li>
<li><tt class="docutils literal"><span class="pre">addon</span></tt>       - an addon to the mojito system</li>
<li><tt class="docutils literal"><span class="pre">archetype</span></tt>   - the commands to create resources as described in the output from
<tt class="docutils literal"><span class="pre">mojito</span> <span class="pre">help</span> <span class="pre">create</span></tt></li>
<li><tt class="docutils literal"><span class="pre">spec</span></tt>        - the configuration for a mojit instance</li>
<li><tt class="docutils literal"><span class="pre">yui-lang</span></tt>    - a YUI 3 language bundle</li>
<li><tt class="docutils literal"><span class="pre">yui-module</span></tt>  - a YUI 3 module (that isn&#8217;t one of the above)</li>
</ul>
<div class="section" id="subtypes">
<span id="types-subtypes"></span><h4>Subtypes<a class="headerlink" href="#subtypes" title="Permalink to this headline">¶</a></h4>
<p>You can use a subtype to specify types of a <tt class="docutils literal"><span class="pre">type</span></tt>. For example, a
resource of <tt class="docutils literal"><span class="pre">type:addon</span></tt> might have subtypes, such as <tt class="docutils literal"><span class="pre">subtype:ac</span></tt>
for AC addons,  <tt class="docutils literal"><span class="pre">subtype:view-engine</span></tt> for view engines, or <tt class="docutils literal"><span class="pre">subtype:rs</span></tt>
for Resource Store addons.</p>
<p>For <tt class="docutils literal"><span class="pre">type:archetype</span></tt>, the subtypes could be <tt class="docutils literal"><span class="pre">subtype:app</span></tt>  or
<tt class="docutils literal"><span class="pre">subtype:mojit</span></tt>.  The subtype specifies what archetype Mojito should create,
such as an application or mojit. (There may be more in the future!)</p>
</div>
</div>
<div class="section" id="selector-property">
<span id="sel-prop"></span><h3>selector Property<a class="headerlink" href="#selector-property" title="Permalink to this headline">¶</a></h3>
<p>The  <strong>selector</strong> is an arbitrary user-defined string, which is used to
<em>select</em> which version of each resource to use.  The selector is defined in
the <tt class="docutils literal"><span class="pre">application.json</span></tt> with the <tt class="docutils literal"><span class="pre">selector</span></tt> property. Because the selector
is a global entity, you cannot define it at the mojit level. For example, you
cannot define the selector in the <tt class="docutils literal"><span class="pre">defaults.json</span></tt> of a mojit.</p>
<p>The value of the <tt class="docutils literal"><span class="pre">selector</span></tt> property is a string that must not have a
period (<tt class="docutils literal"><span class="pre">'.'</span></tt>) or slash (<tt class="docutils literal"><span class="pre">'/'</span></tt>) in it.  In practice, it&#8217;s suggested to use
alphanumeric and hyphen (&#8216;-&#8216;) characters only.</p>
<p>Only one selector can be used in each configuration object identified by the
<tt class="docutils literal"><span class="pre">setting</span></tt> property, which defines the context. The specified selectors
must match the selector found in the resource file names.  So, for example,
the template <tt class="docutils literal"><span class="pre">views/index.iphone.hb.html</span></tt> has the selector <tt class="docutils literal"><span class="pre">iphone</span></tt>.</p>
<div class="section" id="example">
<span id="sel-prop-ex"></span><h4>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h4>
<p>The selector is typically used in conjunction with a context to specify a
resource for a particular device. In the example <tt class="docutils literal"><span class="pre">application.json</span></tt> below,
the selector <tt class="docutils literal"><span class="pre">ipad</span></tt> is defined when the context is <tt class="docutils literal"><span class="pre">device:ipad</span></tt>. If an
application is running in the <tt class="docutils literal"><span class="pre">device:ipad</span></tt> context, Mojito will select
resources with <tt class="docutils literal"><span class="pre">ipad</span></tt> identifier. Thus, Mojito might render the template
<tt class="docutils literal"><span class="pre">index.ipad.hb.html</span></tt> and <strong>not</strong> <tt class="docutils literal"><span class="pre">index.iphone.hb.html</span></tt>.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;master&quot;</span><span class="p">],</span>
    <span class="p">...</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;device:ipad&quot;</span><span class="p">],</span>
    <span class="s2">&quot;selector&quot;</span><span class="o">:</span><span class="s2">&quot;ipad&quot;</span><span class="p">,</span>
    <span class="s2">&quot;specs&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;iPad&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;iPadReader&quot;</span><span class="p">,</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="metatdata-versions">
<span id="id2"></span><h3>Resource Versions<a class="headerlink" href="#metatdata-versions" title="Permalink to this headline">¶</a></h3>
<p>Resources can have many versions that are identified by the
<a class="reference internal" href="#sel-prop"><em>selector property</em></a> and the affinity. The selector is defined
by the user and indicates the version of the resource and the affinity is
defined by the resource itself.</p>
<p>For example, developer might decide to use the selector <tt class="docutils literal"><span class="pre">selector:</span> <span class="pre">iphone</span></tt>
for the iPhone version  and <tt class="docutils literal"><span class="pre">selector:</span> <span class="pre">android</span></tt> for the Android version of a
resource. Using these two selectors, you could have the following two versions
of the <tt class="docutils literal"><span class="pre">index</span></tt> resource of type <tt class="docutils literal"><span class="pre">view</span></tt>:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">index.iphone.hb.html</span></tt></li>
<li><tt class="docutils literal"><span class="pre">index.android.hb.html</span></tt></li>
</ul>
</div>
<div class="section" id="metadata-ex">
<span id="id3"></span><h3>Example<a class="headerlink" href="#metadata-ex" title="Permalink to this headline">¶</a></h3>
<div class="highlight-javascript"><pre>{
  "source": {
    "fs": {
      "fullPath": /"home/me/github-mojito/examples/getting-started-guide/part4/paged-yql/mojits/PagedFlickr/views/index.hb.html",
      "rootDir": "/home/me/github-mojito/yahoo/mojito/github-drewfish/examples/getting-started-guide/part4/paged-yql/mojits/PagedFlickr",
      "rootType": "mojit",
      "subDir": ".",
      "subDirArray": [],
      "isFile": true,
      "ext": ".html",
      "basename": "index.hb"
    },
    "pkg": {
      "name": "paged-yql",
      "version": "0.1.0",
      "depth": 0
    }
  },
  "type": "view",
  "name": "index",
  "id": "view--index",
  "mojit": "PagedFlickr",
  "affinity": "common",
  "selector": "iphone",
  "view": {
    "outputFormat": "html",
    "engine": "hb"
  },
  "url": "/static/PagedFlickr/views/index.hb.html"
}</pre>
</div>
</div>
</div>
<div class="section" id="how-does-the-resource-store-work">
<span id="rs-how-work"></span><h2>How Does the Resource Store Work?<a class="headerlink" href="#how-does-the-resource-store-work" title="Permalink to this headline">¶</a></h2>
<p>Understanding the Resource Store will allow you to debug your
application and write Resource Store addons to customize how it works.</p>
<div class="section" id="how-work-overview">
<span id="id4"></span><h3>Overview<a class="headerlink" href="#how-work-overview" title="Permalink to this headline">¶</a></h3>
<p>In short, the resource store walks through the application-level,
mojit-level, and <tt class="docutils literal"><span class="pre">npm</span></tt> module files (in that order) of a Mojito application,
determines what type of resource each file is, creates metadata about the resource,
and then registers the resource.</p>
<p>During this process, the resource store also does the following:</p>
<ul class="simple">
<li>pre-calculates (&#8220;resolves&#8221;) which resource versions are used for each version
of the mojit.</li>
<li>also keeps track of application-level resources (archetypes, commands,
config files, and middleware).</li>
<li>provides methods and events, including those specialized for AOP.</li>
<li>explicitly uses the addons <em class="xref std std-ref">selector</em> and
<em class="xref std std-ref">config</em>.</li>
</ul>
<p>In the following sections, we&#8217;ll look at the process in a little more details.
To see the code for the resource store, see the <a class="reference external" href="https://github.com/yahoo/mojito/blob/develop/lib/store.server.js">server.store.js</a> file.</p>
</div>
<div class="section" id="walking-the-filesystem">
<span id="how-walk-fs"></span><h3>Walking the Filesystem<a class="headerlink" href="#walking-the-filesystem" title="Permalink to this headline">¶</a></h3>
<p>Resource versions are discovered by the Resource Store at server-start time. The Resource Store
method <tt class="docutils literal"><span class="pre">preload</span></tt> first walks all the files in the application, excluding the
<tt class="docutils literal"><span class="pre">node_modules</span></tt> directory. Next, all the files in the packages in <tt class="docutils literal"><span class="pre">node_modules</span></tt>
are walked.  The packages are walked in breadth-first fashion, so that <em>shallower</em>
packages have precedence over <em>deeper</em> ones. (Not all the packages are used: only
those that have declared themselves as extensions to Mojito.) Finally, if Mojito
wasn&#8217;t found in <tt class="docutils literal"><span class="pre">node_modules</span></tt>, the globally-installed version of Mojito is walked.</p>
<p>After all that, the Resource Store knows about all the resource versions. Then it resolves
those versions into the resources as described in
<a class="reference internal" href="#how-resolution"><em>Resolution and Priorities</em></a>.</p>
</div>
<div class="section" id="resolution-and-priorities">
<span id="how-resolution"></span><h3>Resolution and Priorities<a class="headerlink" href="#resolution-and-priorities" title="Permalink to this headline">¶</a></h3>
<p>The resolving of resource version happens in the Resource Store <tt class="docutils literal"><span class="pre">preload</span></tt> method as well.
The act of resolving the resource versions is really just resolving the
affinities and selectors. See <a class="reference internal" href="#metatdata-versions"><em>Resource Versions</em></a>
for a brief explanation about how affinities and selectors determine different
versions of a resource. The following sections discuss what the Resource Store uses to
resolve versions and create a <strong>priority-ordered selector list (POSL)</strong>.</p>
<div class="section" id="affinities">
<span id="resolution-affinities"></span><h4>Affinities<a class="headerlink" href="#affinities" title="Permalink to this headline">¶</a></h4>
<p>The choice of a resource version depends on the affinity. If we&#8217;re resolving
versions for the server, versions with <tt class="docutils literal"><span class="pre">affinity:server</span></tt> will have higher
priority than <tt class="docutils literal"><span class="pre">affinity:common</span></tt>, and <tt class="docutils literal"><span class="pre">affinity:client</span></tt> will be completely ignored.</p>
</div>
<div class="section" id="selectors">
<span id="resolution-selectors"></span><h4>Selectors<a class="headerlink" href="#selectors" title="Permalink to this headline">¶</a></h4>
<p>The order of the selectors is defined by a POSL, which depends on the runtime context.</p>
<p>Suppose an application has the following resources:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">controller.common.js</span></tt></li>
<li><tt class="docutils literal"><span class="pre">controller.common.iphone.js</span></tt></li>
<li><tt class="docutils literal"><span class="pre">controller.server.js</span></tt></li>
<li><tt class="docutils literal"><span class="pre">controller.server.iphone.js</span></tt></li>
</ul>
<p>In this application, the POSL for context <tt class="docutils literal"><span class="pre">{device:browser}</span></tt> might
be <tt class="docutils literal"><span class="pre">['*']</span></tt>, but the POSL      for the context <tt class="docutils literal"><span class="pre">{device:iphone}</span></tt> might be
<tt class="docutils literal"><span class="pre">['iphone','*']</span></tt>. We need to use a (prioritized) list of selectors instead of
just a &#8220;selector that matches the context&#8221; because not all versions might exist
for all selectors.  In the example above, if <tt class="docutils literal"><span class="pre">controller.server.iphone.js</span></tt>
didn&#8217;t exist, we should still do the right thing for context <tt class="docutils literal"><span class="pre">{device:iphone}</span></tt>.</p>
</div>
<div class="section" id="sources">
<span id="resolution-sources"></span><h4>Sources<a class="headerlink" href="#sources" title="Permalink to this headline">¶</a></h4>
<p>The final consideration for priority is the source. Mojit-level versions have
higher priority than shared versions.  Let&#8217;s take a different application with
the following resources:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">mojits/Foo/models/bar.common.js</span></tt></li>
<li><tt class="docutils literal"><span class="pre">models/bar.common.js</span></tt></li>
</ul>
<p>In this application, the second resource is shared with all mojits. The mojit
<tt class="docutils literal"><span class="pre">Foo</span></tt>, however, has defined its own version of the same resource
(<tt class="docutils literal"><span class="pre">id:</span> <span class="pre">model--bar</span></tt>), and so that should have higher priority than the shared
one.</p>
</div>
<div class="section" id="relationships">
<span id="resolution-relationships"></span><h4>Relationships<a class="headerlink" href="#relationships" title="Permalink to this headline">¶</a></h4>
<p>Finally, there&#8217;s a relationship between the different types of priority.</p>
<ol class="arabic simple">
<li>The source has the highest priority.</li>
<li>The selector has the next highest priority.</li>
<li>The affinity has the least highest priority.</li>
</ol>
<p>That means that if there exists, for example, both a <tt class="docutils literal"><span class="pre">controller.server.js</span></tt>
and <tt class="docutils literal"><span class="pre">controller.common.iphone.js</span></tt>, for the server and context
<tt class="docutils literal"><span class="pre">{device:iphone}</span></tt>, the second version will be used because its selector
is a higher priority match than its affinity.</p>
<p>All this is pre-calculated for each resource and for each possible runtime
configuration (client or server, and every appropriate runtime context).</p>
</div>
</div>
<div class="section" id="getting-data-from-the-resource-store">
<span id="how-get-data"></span><h3>Getting Data from the Resource Store<a class="headerlink" href="#getting-data-from-the-resource-store" title="Permalink to this headline">¶</a></h3>
<p>Besides the standard ways that Mojito uses the resource store, there are two
generic methods for getting resources and resource versions from the Resource Store.</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">getResourceVersions(filter)</span></tt></li>
<li><tt class="docutils literal"><span class="pre">getResources(env,</span> <span class="pre">ctx,</span> <span class="pre">filter)</span></tt></li>
</ul>
<p>The APIs are intentionally similar.  Both return an array of resources, and the
<tt class="docutils literal"><span class="pre">filter</span></tt> argument can be used to restrict the returned resources
(or versions). The <tt class="docutils literal"><span class="pre">filter</span></tt> is an object whose keys and values must match
the returned resources (or versions).  Think of it as a <em>template</em> or <em>partial
resource</em> that all resources must match. For example, a filter of
<tt class="docutils literal"><span class="pre">{type:'view'}</span></tt> will return all the views.</p>
<p>For mojit-level resources or resource versions, specify the mojit name in the
filter. For example, filter <tt class="docutils literal"><span class="pre">{mojit:'Foo'}</span></tt> will return all resources
(or versions) in the <tt class="docutils literal"><span class="pre">Foo</span></tt> mojit.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Because of the resolution process, the resources returned for filter
<tt class="docutils literal"><span class="pre">{mojit:'Foo'}</span></tt> might contain shared resources.</p>
</div>
<p>To get mojit-level resources (or versions) from multiple mojits, you&#8217;ll have to
call the method <tt class="docutils literal"><span class="pre">getResourceVersions</span></tt> or <tt class="docutils literal"><span class="pre">getResources</span></tt> for each mojit.
You can call <tt class="docutils literal"><span class="pre">listAllMojits</span></tt> to get a list of all mojits.</p>
</div>
</div>
<div class="section" id="creating-your-own-resource-store-addons">
<span id="rs-creating-rs-addons"></span><h2>Creating Your Own Resource Store Addons<a class="headerlink" href="#creating-your-own-resource-store-addons" title="Permalink to this headline">¶</a></h2>
<div class="section" id="creating-rs-addons-intro">
<span id="id5"></span><h3>Intro<a class="headerlink" href="#creating-rs-addons-intro" title="Permalink to this headline">¶</a></h3>
<p>In this section, we will discuss the key methods, events, and give a simple
example of a custom Resource Store addon. By using the provided example as a model
and referring to the <a class="reference external" href="http://developer.yahoo.com/cocktails/mojito/api/classes/ResourceStore.server.html">ResourceStore.server Class</a> in the API documentation, you should be able to
create your own custom Resource Store addons.</p>
</div>
<div class="section" id="anatomy-of-a-rs-addon">
<span id="creating-rs-addons-anatomy"></span><h3>Anatomy of a Resource Store Addon<a class="headerlink" href="#anatomy-of-a-rs-addon" title="Permalink to this headline">¶</a></h3>
<p>The resource store addons are implemented using the <a class="reference external" href="http://yuilibrary.com/yui/docs/plugin/">YUI Plugin</a> mechanism.
In essence, a Mojito addon is a YUI plugin, so the skeleton of a Resource Store addon
will be the same as that of a YUI Plugin.</p>
<p>See the <a class="reference external" href="http://developer.yahoo.com/cocktails/mojito/api/classes/ResourceStore.server.html">ResourceStore.server Class</a> for the parameters and return values for the Resource Store methods.</p>
<div class="section" id="key-methods">
<span id="anatomy-key-methods"></span><h4>Key Methods<a class="headerlink" href="#key-methods" title="Permalink to this headline">¶</a></h4>
<span class="target" id="key-methods-initialize"></span><dl class="function">
<dt id="initialize">
<tt class="descname">initialize</tt><big>(</big><em>config</em><big>)</big><a class="headerlink" href="#initialize" title="Permalink to this definition">¶</a></dt>
<dd><p>This method sets the paths to find the application, Mojito, and Resource Store files.
Addons should hook into Resource Store methods (using AOP) or events fired by the Resource Store
in this method.</p>
<p>The following host methods are called:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="#preloadResourceVersions" title="preloadResourceVersions"><tt class="xref js js-func docutils literal"><span class="pre">preloadResourceVersions()</span></tt></a></li>
<li><a class="reference internal" href="#resolveResourceVersions" title="resolveResourceVersions"><tt class="xref js js-func docutils literal"><span class="pre">resolveResourceVersions()</span></tt></a></li>
</ul>
</div></blockquote>
<p>After <tt class="docutils literal"><span class="pre">preload</span></tt> has finished executing, you can call
<tt class="docutils literal"><span class="pre">afterHostMethod('preload',</span> <span class="pre">...)</span></tt>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>config</strong> (<em>Object</em>) &#8211; <p>Contains configuration information with the following properties:</p>
<ul>
<li><dl class="attribute">
<dt id="config.appRoot">
<tt class="descclassname">config.</tt><tt class="descname">appRoot</tt><a class="headerlink" href="#config.appRoot" title="Permalink to this definition">¶</a></dt>
<dd><p>(<em>String</em>) &#8211; contains the the directory of the application.</p>
</dd></dl>

</li>
<li><dl class="attribute">
<dt id="config.mojitoRoot">
<tt class="descclassname">config.</tt><tt class="descname">mojitoRoot</tt><a class="headerlink" href="#config.mojitoRoot" title="Permalink to this definition">¶</a></dt>
<dd><p>(<em>String</em>) &#8211; contains the directory of the Mojito framework code.</p>
</dd></dl>

</li>
</ul>
</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">None</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="preload">
<tt class="descname">preload</tt><big>(</big><big>)</big><a class="headerlink" href="#preload" title="Permalink to this definition">¶</a></dt>
<dd><p>Addons are loaded during this method, so they cannot be called before <tt class="docutils literal"><span class="pre">preload</span></tt>
is called.</p>
</dd></dl>

<dl class="function">
<dt id="preloadResourceVersions">
<tt class="descname">preloadResourceVersions</tt><big>(</big><big>)</big><a class="headerlink" href="#preloadResourceVersions" title="Permalink to this definition">¶</a></dt>
<dd><p>The Resource Store walks the filesystem in this method. Before <tt class="docutils literal"><span class="pre">preloadResourceVersions</span></tt> is
called, not much is known, though the static application configuration is available
using the method <tt class="docutils literal"><span class="pre">getStaticAppConfig</span></tt>.</p>
<p>Within the <tt class="docutils literal"><span class="pre">preloadResourceVersions</span></tt> method, the following host methods are called:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">findResourceVersionByConvention</span></tt></li>
<li><em class="xref std std-ref">parseResourceVersion</em></li>
<li><em class="xref std std-ref">addResourceVersion</em></li>
</ul>
</div></blockquote>
<p>After <tt class="docutils literal"><span class="pre">preloadResourceVersions</span></tt> has been called:</p>
<blockquote>
<div><ul class="simple">
<li>All the resource versions have been loaded and are available through the method
<tt class="docutils literal"><span class="pre">getResourceVersions</span></tt>.</li>
<li>The Resource Store has <tt class="docutils literal"><span class="pre">selectors</span></tt> object whose keys are all selectors in the application.
The values for the keys are just <tt class="docutils literal"><span class="pre">true</span></tt>.</li>
</ul>
</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="findResourceVersionByConvention">
<tt class="descname">findResourceVersionByConvention</tt><big>(</big><big>)</big><a class="headerlink" href="#findResourceVersionByConvention" title="Permalink to this definition">¶</a></dt>
<dd><p>This method is called on each directory or file being walked and is used to decide if
the path is a resource version. The return value can be a bit confusing, so read the
API documentation carefully and feel free to post any questions that you have to the
<a class="reference external" href="http://developer.yahoo.com/forum/Yahoo-Mojito/">Yahoo! Mojito Forum</a>.</p>
<p>Typically, you would hook into this method with the <tt class="docutils literal"><span class="pre">afterHostMethod</span></tt> method to
register your own resource version types. This method should work together with your
own version of the <tt class="docutils literal"><span class="pre">parseResourceVersion</span></tt> method.</p>
</dd></dl>

<dl class="function">
<dt id="parseResourceVersion">
<tt class="descname">parseResourceVersion</tt><big>(</big><big>)</big><a class="headerlink" href="#parseResourceVersion" title="Permalink to this definition">¶</a></dt>
<dd><p>This method creates an actual resource version. Typically, you would hook into this
method with the <tt class="docutils literal"><span class="pre">beforeHostMethod</span></tt> method to create your own resource versions. This
should work together with your own version of the
<a class="reference internal" href="#findResourceVersionByConvention" title="findResourceVersionByConvention"><tt class="xref js js-func docutils literal"><span class="pre">findResourceVersionByConvention()</span></tt></a> method.</p>
</dd></dl>

<dl class="function">
<dt id="addResourceVersion">
<tt class="descname">addResourceVersion</tt><big>(</big><big>)</big><a class="headerlink" href="#addResourceVersion" title="Permalink to this definition">¶</a></dt>
<dd><p>This method is called to save the resource version into the Resource Store. Typically, if you
want to modify/augment an existing resource version, hook into this with the
<tt class="docutils literal"><span class="pre">beforeHostMethod</span></tt> method.</p>
</dd></dl>

<dl class="function">
<dt id="resolveResourceVersions">
<tt class="descname">resolveResourceVersions</tt><big>(</big><big>)</big><a class="headerlink" href="#resolveResourceVersions" title="Permalink to this definition">¶</a></dt>
<dd><p>This method resolves the resource versions into resources. As a resource version is
resolved, the <tt class="docutils literal"><span class="pre">mojitResourcesResolved</span></tt> event is called. After the method has been
executed, all resource versions have been resolved.</p>
</dd></dl>

<dl class="function">
<dt id="serializeClientStore">
<tt class="descname">serializeClientStore</tt><big>(</big><big>)</big><a class="headerlink" href="#serializeClientStore" title="Permalink to this definition">¶</a></dt>
<dd><p>This method is called during runtime as Mojito creates the configuration for the
client-side Mojito.</p>
</dd></dl>

<p>To access the Resource Store, you call <tt class="docutils literal"><span class="pre">this.get('host')</span></tt>. The method returns the
Resource Store.</p>
</div>
<div class="section" id="key-events">
<span id="anatomy-key-events"></span><h4>Key Events<a class="headerlink" href="#key-events" title="Permalink to this headline">¶</a></h4>
<p>This event is called when the resources in a mojit are resolved.</p>
<p>This event is called during runtime as Mojito creates an <em>instance</em> used to
dispatch a mojit.</p>
</div>
</div>
<div class="section" id="creating-rs-addons-ex">
<span id="id7"></span><h3>Example<a class="headerlink" href="#creating-rs-addons-ex" title="Permalink to this headline">¶</a></h3>
<div class="section" id="rs-addon">
<span id="creating-rs-addons-ex-rs-addon"></span><h4>Resource Store Addon<a class="headerlink" href="#rs-addon" title="Permalink to this headline">¶</a></h4>
<p>The following Resource Store addon registers the new resource type <tt class="docutils literal"><span class="pre">text</span></tt> for text
files.</p>
<p><tt class="docutils literal"><span class="pre">addons/rs/text.server.js</span></tt></p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;addon-rs-text&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">NAME</span><span class="p">)</span> <span class="p">{</span>

  <span class="kd">var</span> <span class="nx">libpath</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>

  <span class="kd">function</span> <span class="nx">RSddonText</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">RSAddonText</span><span class="p">.</span><span class="nx">superclass</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">RSAddonText</span><span class="p">.</span><span class="nx">NS</span> <span class="o">=</span> <span class="s1">&#39;text&#39;</span><span class="p">;</span>
  <span class="nx">RSAddonText</span><span class="p">.</span><span class="nx">ATTResourceStore</span> <span class="o">=</span> <span class="p">{};</span>

  <span class="nx">Y</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">RSAddonText</span><span class="p">,</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Plugin</span><span class="p">.</span><span class="nx">Base</span><span class="p">,</span> <span class="p">{</span>

    <span class="nx">initializer</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">appRoot</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">appRoot</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">mojitoRoot</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">mojitoRoot</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">afterHostMethod</span><span class="p">(</span><span class="s1">&#39;findResourceVersionByConvention&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">findResourceVersionByConvention</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">beforeHostMethod</span><span class="p">(</span><span class="s1">&#39;parseResourceVersion&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseResourceVersion</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">destructor</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">// TODO:  needed to break cycle so we don&#39;t leak memory?</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">    * Using AOP, this is called after the ResourceStore&#39;s version.</span>
<span class="cm">    * @method findResourceVersionByConvention</span>
<span class="cm">    * @param source {object} metadata about where the resource is located</span>
<span class="cm">    * @param mojitType {string} name of mojit to which the resource likely belongs</span>
<span class="cm">    * @return {object||null} for config file resources, returns metadata signifying that</span>
<span class="cm">    */</span>
    <span class="nx">findResourceVersionByConvention</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">source</span><span class="p">,</span> <span class="nx">mojitType</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// We only care about files</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">source</span><span class="p">.</span><span class="nx">fs</span><span class="p">.</span><span class="nx">isFile</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="c1">// We only care about txt files</span>
      <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;.txt&#39;</span> <span class="o">!==</span> <span class="nx">source</span><span class="p">.</span><span class="nx">fs</span><span class="p">.</span><span class="nx">ext</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="k">new</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Do</span><span class="p">.</span><span class="nx">AlterReturn</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;text&#39;</span>
      <span class="p">});</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">    * Using AOP, this is called before the ResourceStore&#39;s version.</span>
<span class="cm">    * @method parseResourceVersion</span>
<span class="cm">    * @param source {object} metadata about where the resource is located</span>
<span class="cm">    * @param type {string} type of the resource</span>
<span class="cm">    * @param subtype {string} subtype of the resource</span>
<span class="cm">    * @param mojitType {string} name of mojit to which the resource likely belongs</span>
<span class="cm">    * @return {object||null} for config file resources, returns the resource metadata</span>
<span class="cm">    */</span>
    <span class="nx">parseResourceVersion</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">source</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">subtype</span><span class="p">,</span> <span class="nx">mojitType</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">res</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;text&#39;</span> <span class="o">!==</span> <span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">res</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">source</span><span class="o">:</span> <span class="nx">source</span><span class="p">,</span>
        <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span>
        <span class="nx">affinity</span><span class="o">:</span> <span class="s1">&#39;server&#39;</span><span class="p">,</span>
        <span class="nx">selector</span><span class="o">:</span> <span class="s1">&#39;*&#39;</span>
      <span class="p">};</span>
      <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;app&#39;</span> <span class="o">!==</span> <span class="nx">source</span><span class="p">.</span><span class="nx">fs</span><span class="p">.</span><span class="nx">rootType</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">mojit</span> <span class="o">=</span> <span class="nx">mojitType</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">libpath</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">source</span><span class="p">.</span><span class="nx">fs</span><span class="p">.</span><span class="nx">subDir</span><span class="p">,</span> <span class="nx">source</span><span class="p">.</span><span class="nx">fs</span><span class="p">.</span><span class="nx">basename</span><span class="p">);</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="p">[</span><span class="nx">res</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span> <span class="nx">res</span><span class="p">.</span><span class="nx">subtype</span><span class="p">,</span> <span class="nx">res</span><span class="p">.</span><span class="nx">name</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">Do</span><span class="p">.</span><span class="nx">Halt</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
  <span class="nx">Y</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s1">&#39;mojito.addons.rs&#39;</span><span class="p">);</span>
  <span class="nx">Y</span><span class="p">.</span><span class="nx">mojito</span><span class="p">.</span><span class="nx">addons</span><span class="p">.</span><span class="nx">rs</span><span class="p">.</span><span class="nx">text</span> <span class="o">=</span> <span class="nx">ResourceStoreAddonText</span><span class="p">;</span>

<span class="p">},</span> <span class="s1">&#39;0.0.1&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">requires</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;plugin&#39;</span><span class="p">,</span> <span class="s1">&#39;oop&#39;</span><span class="p">]});</span>
</pre></div>
</div>
</div>
<div class="section" id="text-actioncontext-addon">
<span id="creating-rs-addons-ex-text-addon"></span><h4>Text ActionContext Addon<a class="headerlink" href="#text-actioncontext-addon" title="Permalink to this headline">¶</a></h4>
<p>The Text Addon provides accessors so that the controller can access resources
of type <tt class="docutils literal"><span class="pre">text</span></tt>. You could use this example addon as a model for writing an
addon that allows a controller to access other resource types such as <tt class="docutils literal"><span class="pre">xml</span></tt>
or <tt class="docutils literal"><span class="pre">yaml</span></tt>.</p>
<p><tt class="docutils literal"><span class="pre">addons/ac/text.server.js</span></tt></p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;addon-ac-text&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">NAME</span><span class="p">)</span> <span class="p">{</span>

  <span class="kd">var</span> <span class="nx">libfs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>

  <span class="kd">function</span> <span class="nx">Addon</span><span class="p">(</span><span class="nx">command</span><span class="p">,</span> <span class="nx">adapter</span><span class="p">,</span> <span class="nx">ac</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_ctx</span> <span class="o">=</span> <span class="nx">ac</span><span class="p">.</span><span class="nx">command</span><span class="p">.</span><span class="nx">context</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">Addon</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>

    <span class="nx">namespace</span><span class="o">:</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span>

    <span class="nx">setStore</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">store</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_store</span> <span class="o">=</span> <span class="nx">store</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">list</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">ress</span><span class="p">,</span> <span class="nx">list</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">ress</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_store</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">getResources</span><span class="p">(</span><span class="s1">&#39;server&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ctx</span><span class="p">,</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span><span class="s1">&#39;text&#39;</span><span class="p">});</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">r</span> <span class="o">&lt;</span> <span class="nx">ress</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">r</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span> <span class="o">=</span> <span class="nx">ress</span><span class="p">[</span><span class="nx">r</span><span class="p">];</span>
        <span class="nx">list</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">list</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">read</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">ress</span><span class="p">;</span>
      <span class="nx">ress</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_store</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">getResources</span><span class="p">(</span><span class="s1">&#39;server&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ctx</span><span class="p">,</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span><span class="nx">name</span><span class="p">});</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">ress</span> <span class="o">||</span> <span class="mi">1</span> <span class="o">!==</span> <span class="nx">ress</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">cb</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Unknown text file &#39;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="nx">libfs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">ress</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">source</span><span class="p">.</span><span class="nx">fs</span><span class="p">.</span><span class="nx">fullPath</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">body</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="nx">Y</span><span class="p">.</span><span class="nx">mojito</span><span class="p">.</span><span class="nx">addons</span><span class="p">.</span><span class="nx">ac</span><span class="p">.</span><span class="nx">text</span> <span class="o">=</span> <span class="nx">Addon</span><span class="p">;</span>
  <span class="p">},</span> <span class="s1">&#39;0.1.0&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">requires</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;mojito&#39;</span><span class="p">]}</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="controller">
<span id="creating-rs-addons-ex-controller"></span><h4>Controller<a class="headerlink" href="#controller" title="Permalink to this headline">¶</a></h4>
<p><tt class="docutils literal"><span class="pre">mojits/Viewer/controller.server.js</span></tt></p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;Viewer&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">NAME</span><span class="p">)</span> <span class="p">{</span>

  <span class="nx">Y</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s1">&#39;mojito.controllers&#39;</span><span class="p">)[</span><span class="nx">NAME</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

    <span class="nx">index</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ac</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">chosen</span><span class="p">;</span> <span class="c1">// TODO:  use form input to choose a text file</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">chosen</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">list</span><span class="p">;</span>
        <span class="nx">list</span> <span class="o">=</span> <span class="nx">ac</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">list</span><span class="p">();</span>
        <span class="nx">chosen</span> <span class="o">=</span> <span class="nx">list</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="nx">ac</span><span class="p">.</span><span class="nx">assets</span><span class="p">.</span><span class="nx">addCss</span><span class="p">(</span><span class="s1">&#39;./index.css&#39;</span><span class="p">);</span>
      <span class="nx">ac</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">read</span><span class="p">(</span><span class="nx">chosen</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">ac</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">ac</span><span class="p">.</span><span class="nx">done</span><span class="p">({</span><span class="nx">body</span><span class="o">:</span> <span class="nx">body</span><span class="p">});</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">},</span> <span class="s1">&#39;1.0.1&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">requires</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;mojito&#39;</span><span class="p">,</span> <span class="s1">&#39;mojito-assets-addon&#39;</span><span class="p">,</span> <span class="s1">&#39;addon-ac-text&#39;</span><span class="p">]});</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="resource-store-built-in-addons">
<span id="rs-addons"></span><h2>Resource Store Built-In Addons<a class="headerlink" href="#resource-store-built-in-addons" title="Permalink to this headline">¶</a></h2>
<div class="section" id="addons-intro">
<span id="id8"></span><h3>Intro<a class="headerlink" href="#addons-intro" title="Permalink to this headline">¶</a></h3>
<p>Mojito comes with built-in resource store addons that are used by the Resource Store
and the Mojito framework. These resource store addons are required by the Resource Store
and the Mojito framework. Thus, particular care must be taken when creating
custom versions of them.</p>
<p>The Resource Store comes with the following four built-in addons:</p>
<ul>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">config</span></tt></dt>
<dd><ul class="first last simple">
<li>registers new resource type <tt class="docutils literal"><span class="pre">config</span></tt> found in JSON configuration files</li>
<li>provides an API for reading both contextualized and straight-JSON files</li>
<li>provides sugar for reading an application&#8217;s dimensions</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">selector</span></tt></dt>
<dd><ul class="first last simple">
<li>decides the priority-ordered list (POSL) to use for a context</li>
<li>looks  for <tt class="docutils literal"><span class="pre">selector</span></tt> in <tt class="docutils literal"><span class="pre">application.json</span></tt>. Because
<tt class="docutils literal"><span class="pre">application.json</span></tt> is a context configuration file, the <tt class="docutils literal"><span class="pre">selector</span></tt> can
be contextualized there.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">url</span></tt></dt>
<dd><ul class="first last simple">
<li>calculates the static handler URL for appropriate resources (and resource versions)</li>
<li>stores the URL in the <tt class="docutils literal"><span class="pre">url</span></tt> key of the resource</li>
<li>calculates the asset URL base for each mojit</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">yui</span></tt></dt>
<dd><ul class="first last simple">
<li>registers new resource type <tt class="docutils literal"><span class="pre">yui-module</span></tt> found in the directories
<tt class="docutils literal"><span class="pre">yui_modules</span></tt> or <tt class="docutils literal"><span class="pre">autoload</span></tt></li>
<li>registers new resource type <tt class="docutils literal"><span class="pre">yui-lang</span></tt> found in the <tt class="docutils literal"><span class="pre">lang</span></tt> directory</li>
<li>calculates the <tt class="docutils literal"><span class="pre">yui</span></tt> metadata for resource versions that are YUI modules</li>
<li>pre-calculates corresponding YUI module dependencies when resources are
resolved for each version of each mojit</li>
<li>appends the pre-calculated YUI module dependencies for the controller and
binders when Mojito queries the Resource Store for the details of a mojit
(<tt class="docutils literal"><span class="pre">getMojitTypeDetails</span></tt> method)</li>
<li>provides methods used by Mojito to configure its YUI instances</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="creating-custom-versions-of-built-in-rs-addons">
<span id="addons-custom"></span><h3>Creating Custom Versions of Built-In Resource Store Addons<a class="headerlink" href="#creating-custom-versions-of-built-in-rs-addons" title="Permalink to this headline">¶</a></h3>
<p>We will be examining the <tt class="docutils literal"><span class="pre">selector</span></tt> and <tt class="docutils literal"><span class="pre">url</span></tt> addons to help you create
custom versions of those addons. We do not recommend that you create custom
versions of the <tt class="docutils literal"><span class="pre">config</span></tt> or <tt class="docutils literal"><span class="pre">yui</span></tt> addons, so we will not be looking at
those addons. Also, this documentation explains what the Resource Store expects the
addon to do, so you can create your own version of the addons. To learn what
the Resource Store built-in addons do, please refer to the <a class="reference external" href="http://developer.yahoo.com/cocktails/mojito/api/classes/ResourceStore.server.html">ResourceStore.server Class</a> in the API
documentation.</p>
<div class="section" id="selector">
<span id="custom-selector"></span><h4>selector<a class="headerlink" href="#selector" title="Permalink to this headline">¶</a></h4>
<p>If you wish to use a different algorithm for to determine the selectors
to use, you can implement your own version of this Resource Store addon in the
<tt class="docutils literal"><span class="pre">addons/rs/selector.server.js</span></tt> file of your application.</p>
<p>Because the <tt class="docutils literal"><span class="pre">selector</span></tt> addon is used directly by the the resource store, all
implementations need to provide the following method:</p>
<ul class="simple">
<li><tt class="xref js js-func docutils literal"><span class="pre">getPOSLFromContext(ctx)()</span></tt></li>
</ul>
<dl class="function">
<dt id="getPOSLFromContext">
<tt class="descname">getPOSLFromContext</tt><big>(</big><em>ctx</em><big>)</big><a class="headerlink" href="#getPOSLFromContext" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the priority-ordered selector list (POSL) for the context.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>ctx</strong> (<em>String</em>) &#8211; The context that the application is running in.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Array</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="getAllPOSLs">
<tt class="descname">getAllPOSLs</tt><big>(</big><big>)</big><a class="headerlink" href="#getAllPOSLs" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns all POSLs in the application.</p>
</dd></dl>

</div>
<div class="section" id="url">
<span id="url-intro"></span><h4>url<a class="headerlink" href="#url" title="Permalink to this headline">¶</a></h4>
<p>The <tt class="docutils literal"><span class="pre">url</span></tt> addon calculates and manages the static handler URLs for resources.
The addon is not used by resource store core, but used by the static handler
middleware.</p>
<p>If you wish to use a different algorithm to determine the URLs, you can
implement your own version of this Resource Store addon in the
<tt class="docutils literal"><span class="pre">addons/rs/url.server.js</span></tt> file of your application.</p>
<p>After the method <tt class="docutils literal"><span class="pre">preloadResourceVersions</span></tt> sets <tt class="docutils literal"><span class="pre">res.url</span></tt> to the static
handler URL for the resource, the method <tt class="docutils literal"><span class="pre">getMojitTypeDetails</span></tt> sets the
mojit&#8217;s <tt class="docutils literal"><span class="pre">assetsRoot</span></tt>. The static handler URL can be a rollup URL.</p>
<p>Your addon is required to do the following:</p>
<ul class="simple">
<li>Set the <tt class="docutils literal"><span class="pre">url</span></tt> property in the resource <tt class="docutils literal"><span class="pre">metadata</span></tt> object.</li>
</ul>
</div>
</div>
</div>
</div>

   </div>

