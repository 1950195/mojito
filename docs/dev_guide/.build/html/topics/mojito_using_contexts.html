

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
     <title>Using Context Configurations</title>
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '',
        COLLAPSE_INDEX: true,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/theme_extras.js"></script>
   </head> 

     <div class="header"><h1 class="heading"><a href="#">
          <span>Mojito</span></a></h1>
      </div>
      <div class="topnav">
        <p>
        <a class="uplink" href="../">Mojito Documentation</a>
        &#160;&#160;::&#160;&#160;
        <a href="../index.html" title="Mojito">Mojito</a>
        &#160;&#160;::&#160;&#160;
        
           <a href="mojito_extensions.html">Extending Mojito</a>
        &#160;&#160;::&#160;&#160;
        
        
           <a href="mojito_yui_config.html">Configuring YUI in Mojito</a>
        
        </p>

      </div>
      <div class="content">
   <div class="section" id="using-context-configurations">
<h1>Using Context Configurations<a class="headerlink" href="#using-context-configurations" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<span id="context-configs-intro"></span><h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Context configurations are how Mojito enables different configurations to be
used based on various runtime factors. Many factors are predefined such as
language and device, but you can create custom ones as well. These runtime
factors are called <strong>contexts</strong> in Mojito and are mapped to user-defined
configurations. For example, you could set the configuration
<tt class="docutils literal"><span class="pre">logLevel</span></tt> to <tt class="docutils literal"><span class="pre">error</span></tt> in the production context and set it to <tt class="docutils literal"><span class="pre">info</span></tt>
in the development context.</p>
<div class="section" id="why-use-context-configurations">
<span id="context-configs-intro-why"></span><h3>Why Use Context Configurations?<a class="headerlink" href="#why-use-context-configurations" title="Permalink to this headline">¶</a></h3>
<p>Context configurations make it possible to do the following:</p>
<ul class="simple">
<li>Create sets of configurations associated with environments without affecting
the application running with the <em>master</em> configurations
<tt class="docutils literal"><span class="pre">&quot;setting:</span> <span class="pre">[&quot;master&quot;]</span></tt>.</li>
<li>Customize content for users: Applications can dynamically apply language and
device configurations by determining the user&#8217;s language preferences and the
device making the HTTP request.</li>
</ul>
</div>
</div>
<div class="section" id="what-is-a-context">
<span id="context-configs-what"></span><h2>What is a Context?<a class="headerlink" href="#what-is-a-context" title="Permalink to this headline">¶</a></h2>
<p>The context is the runtime parameters that are either statically set
(base context) on the command line or dynamically set (request context)
in the HTTP headers and/or the request query string. The configurations
for request contexts override those of the base context.</p>
<div class="section" id="base-context">
<span id="context-configs-what-base"></span><h3>Base Context<a class="headerlink" href="#base-context" title="Permalink to this headline">¶</a></h3>
<p>The base context is statically set with the <tt class="docutils literal"><span class="pre">--context</span></tt> option when you
start an application.</p>
<div class="section" id="syntax">
<span id="context-base-syntax"></span><h4>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h4>
<p>The base context has the following syntax:</p>
<p><tt class="docutils literal"><span class="pre">&quot;key1:value1[,key2:value2]&quot;</span></tt></p>
</div>
<div class="section" id="example">
<span id="context-base-ex"></span><h4>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h4>
<p>The following starts the application with the base context
<tt class="docutils literal"><span class="pre">environment:production</span></tt>:</p>
<p><tt class="docutils literal"><span class="pre">$</span> <span class="pre">mojito</span> <span class="pre">start</span> <span class="pre">--context</span> <span class="pre">&quot;environment:production&quot;</span></tt></p>
</div>
</div>
<div class="section" id="request-contexts">
<span id="context-configs-what-request"></span><h3>Request Contexts<a class="headerlink" href="#request-contexts" title="Permalink to this headline">¶</a></h3>
<p>Contexts that are dynamically invoked by HTTP requests are called request
contexts. When Mojito receives an HTTP request that specifies a context,
the configurations mapped to that context will be dynamically applied.
The contexts can be specified in HTTP request as a parameter in the query
string or in the HTTP header.</p>
<div class="section" id="request-headers">
<span id="context-request-headers"></span><h4>Request Headers<a class="headerlink" href="#request-headers" title="Permalink to this headline">¶</a></h4>
<p>The contexts for languages can be requested using the HTTP header
<tt class="docutils literal"><span class="pre">Accept-Language</span></tt>. After starting an application with the context
<tt class="docutils literal"><span class="pre">&quot;environment:testing&quot;</span></tt>, you can dynamically apply the configurations
for the context <tt class="docutils literal"><span class="pre">&quot;environment:testing,lang:fr&quot;</span></tt> by sending the HTTP
header <tt class="docutils literal"><span class="pre">&quot;Accept-Language:</span> <span class="pre">fr&quot;</span></tt>. In the same way, the contexts for
devices can be requested using the HTTP header <tt class="docutils literal"><span class="pre">User-Agent</span></tt>. The
configurations for the context &#8220;device:android&#8221; could be requested
with the HTTP header <tt class="docutils literal"><span class="pre">&quot;User-Agent:</span> <span class="pre">Mozilla/5.0</span> <span class="pre">(Linux;</span> <span class="pre">U;</span> <span class="pre">Android</span> <span class="pre">2.3;</span> <span class="pre">en-us)&quot;</span></tt>.</p>
</div>
<div class="section" id="query-string-parameters">
<span id="context-request-query-str"></span><h4>Query String Parameters<a class="headerlink" href="#query-string-parameters" title="Permalink to this headline">¶</a></h4>
<p>The  query string can also dynamically set the context.</p>
<div class="section" id="request-query-str-syntax">
<span id="id1"></span><h5>Syntax<a class="headerlink" href="#request-query-str-syntax" title="Permalink to this headline">¶</a></h5>
<p><tt class="docutils literal"><span class="pre">?key1=value1,key2=value2</span></tt></p>
</div>
<div class="section" id="request-query-str-ex">
<span id="id2"></span><h5>Example<a class="headerlink" href="#request-query-str-ex" title="Permalink to this headline">¶</a></h5>
<p>For example, if an application is started with the base context
<tt class="docutils literal"><span class="pre">&quot;environment:testing&quot;</span></tt> and you want to dynamically apply the context
<tt class="docutils literal"><span class="pre">&quot;environment:testing,device:iphone&quot;</span></tt>, you could append the following
query string to the application URL:</p>
<p><tt class="docutils literal"><span class="pre">?device=iphone</span></tt></p>
</div>
</div>
</div>
<div class="section" id="mojito-predefined-contexts">
<span id="contexts-predefined"></span><h3>Mojito Predefined Contexts<a class="headerlink" href="#mojito-predefined-contexts" title="Permalink to this headline">¶</a></h3>
<p>The following lists the contexts that are defined by Mojito. You can define
configurations for these predefined contexts. You can combine multiple contexts
to form a compound context as well. For example, if you wanted a context to map
to configurations for Android devices in a testing environment, you could use
the following compound context: <tt class="docutils literal"><span class="pre">&quot;environment:test,device:android&quot;</span></tt></p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">environment:development</span></tt></li>
<li><tt class="docutils literal"><span class="pre">environment:production</span></tt></li>
<li><tt class="docutils literal"><span class="pre">environment:dev</span></tt></li>
<li><tt class="docutils literal"><span class="pre">environment:test</span></tt></li>
<li><tt class="docutils literal"><span class="pre">environment:stage</span></tt></li>
<li><tt class="docutils literal"><span class="pre">environment:prod</span></tt></li>
<li><tt class="docutils literal"><span class="pre">device:android</span></tt></li>
<li><tt class="docutils literal"><span class="pre">device:blackberry</span></tt></li>
<li><tt class="docutils literal"><span class="pre">device:iemobile</span></tt></li>
<li><tt class="docutils literal"><span class="pre">device:iphone</span></tt></li>
<li><tt class="docutils literal"><span class="pre">device:ipad</span></tt></li>
<li><tt class="docutils literal"><span class="pre">device:kindle</span></tt></li>
<li><tt class="docutils literal"><span class="pre">device:opera-mini</span></tt></li>
<li><tt class="docutils literal"><span class="pre">device:palm</span></tt></li>
<li><tt class="docutils literal"><span class="pre">lang:{BCP</span> <span class="pre">47</span> <span class="pre">language</span> <span class="pre">tag}</span></tt></li>
<li><tt class="docutils literal"><span class="pre">runtime:client</span></tt></li>
<li><tt class="docutils literal"><span class="pre">runtime:server</span></tt></li>
</ul>
<p>You can view the supported BCP 47 language tags and default contexts in the
<a class="reference external" href="https://github.com/yahoo/mojito/blob/develop/lib/dimensions.json">dimensions.json</a>
file of Mojito. You can also <a class="reference internal" href="#context-configs-custom"><em>create custom contexts</em></a>
if the Mojito default contexts don&#8217;t meet the needs of your application.</p>
</div>
</div>
<div class="section" id="how-does-mojito-resolve-context-configurations">
<span id="context-configs-resolution"></span><h2>How Does Mojito Resolve Context Configurations?<a class="headerlink" href="#how-does-mojito-resolve-context-configurations" title="Permalink to this headline">¶</a></h2>
<p>When a request is made to a Mojito application, Mojito has to resolve
configurations, defined contexts (<tt class="docutils literal"><span class="pre">dimensions.json</span></tt>), and the base/requested
contexts before the correct context configurations can be applied.</p>
<p>The following are the steps taken by Mojito to apply the correct context
configurations:</p>
<ol class="arabic">
<li><p class="first"><strong>Determines Valid Contexts:</strong></p>
<p>Mojito looks for a local <tt class="docutils literal"><span class="pre">dimensions.json</span></tt>. If one is found, Mojito
replaces Mojito&#8217;s <tt class="docutils literal"><span class="pre">dimensions.json</span></tt> with it. Mojito then uses
<tt class="docutils literal"><span class="pre">dimensions.json</span></tt> to determine which contexts are valid. Contexts
defined earlier in <tt class="docutils literal"><span class="pre">dimensions.json</span></tt> override contexts defined later
in the file.</p>
</li>
<li><p class="first"><strong>Merges Configurations</strong></p>
<p>Mojito merges configurations for all contexts, with the configurations
in <tt class="docutils literal"><span class="pre">application.json</span></tt> overriding those in <tt class="docutils literal"><span class="pre">defaults.json</span></tt>. If contexts
are found that are not defined in <tt class="docutils literal"><span class="pre">dimensions.json</span></tt>, Mojito will throw
an error.</p>
</li>
<li><p class="first"><strong>Determines Context</strong></p>
<ul class="simple">
<li>Mojito checks if a base context was specified (statically) on the command
line with the <tt class="docutils literal"><span class="pre">--context</span></tt> option.</li>
<li>When Mojito receives an HTTP request, it looks for a request context in
the query string, HTTP headers, or through the execution of a child mojit
with configuration information.</li>
<li>Mojito merges the base context (if any) with the request context (if any).
For example, if the base context is <tt class="docutils literal"><span class="pre">&quot;environment:develop</span></tt>&#8221; and the
request context found in the query string is <tt class="docutils literal"><span class="pre">&quot;?lang=de&quot;</span></tt>, then the
compound context in the <tt class="docutils literal"><span class="pre">setting</span></tt> array in configuration files would
be <tt class="docutils literal"><span class="pre">[&quot;environment:development&quot;,</span> <span class="pre">&quot;lang:de&quot;]</span></tt>.</li>
<li>If no base or request context is found, Mojito then uses the default
context <tt class="docutils literal"><span class="pre">master</span></tt>.</li>
</ul>
</li>
<li><p class="first"><strong>Resolves Context Configurations</strong></p>
<p>Mojito then searches for configurations associated with the determined
context. The contexts are found in the <tt class="docutils literal"><span class="pre">setting</span></tt> object in configuration
files. Mojito will use the more qualified contexts if present over more
general contexts. For example, if the merged base and request context is
<tt class="docutils literal"><span class="pre">&quot;environment:prod,</span> <span class="pre">device:iphone&quot;</span></tt>, then Mojito will use it over either
<tt class="docutils literal"><span class="pre">&quot;device:iphone&quot;</span></tt> or <tt class="docutils literal"><span class="pre">&quot;environment:prod&quot;</span></tt>. If <tt class="docutils literal"><span class="pre">&quot;environment:prod,</span> <span class="pre">device:iphone&quot;</span></tt>
is not present, Mojito will use the request context over the base context
as the resolved context.</p>
</li>
<li><p class="first"><strong>Applies Context Configuration</strong></p>
<p>Mojito applies the configurations associated with the resolved context.</p>
</li>
</ol>
</div>
<div class="section" id="defining-configurations-for-contexts">
<span id="context-configs-define"></span><h2>Defining Configurations for Contexts<a class="headerlink" href="#defining-configurations-for-contexts" title="Permalink to this headline">¶</a></h2>
<p>Configurations for contexts are defined in the application configuration file
<tt class="docutils literal"><span class="pre">application.json</span></tt>. Routing configurations for contexts are defined in the
routing configuration file <tt class="docutils literal"><span class="pre">routes.json</span></tt>. Default configurations are defined
in the <tt class="docutils literal"><span class="pre">defaults.json</span></tt> file of a mojit. All configurations are merged when an
application starts. The configuration values in <tt class="docutils literal"><span class="pre">application.json</span></tt> override
those in <tt class="docutils literal"><span class="pre">defaults.json</span></tt>.</p>
<div class="section" id="configuration-objects">
<span id="context-configs-define-obj"></span><h3>Configuration Objects<a class="headerlink" href="#configuration-objects" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">application.json</span></tt> and <tt class="docutils literal"><span class="pre">routes.json</span></tt> files in the application directory
and the <tt class="docutils literal"><span class="pre">defaults.json</span></tt> file in a mojit&#8217;s directory consist of an array of
configuration objects. The configuration object has a <tt class="docutils literal"><span class="pre">settings</span></tt> array that
specifies the context. The configuration objects in <tt class="docutils literal"><span class="pre">application.json</span></tt> also
have a <tt class="docutils literal"><span class="pre">specs</span></tt> object containing mojit instances, which may also have a
<tt class="docutils literal"><span class="pre">config</span></tt> object that has data in the form of key-value pairs. The configuration
objects in <tt class="docutils literal"><span class="pre">defaults.json</span></tt> do not have a <tt class="docutils literal"><span class="pre">specs</span></tt> object because they do not
define mojits, but do have a <tt class="docutils literal"><span class="pre">config</span></tt> object for storing key-value pairs. The
<tt class="docutils literal"><span class="pre">routes.json</span></tt> file specifies routing configuration such as the path, HTTP
methods, actions, and routing parameters, but does not contain a <tt class="docutils literal"><span class="pre">specs</span></tt> or
a <tt class="docutils literal"><span class="pre">config</span></tt> object.</p>
<div class="section" id="setting">
<span id="context-configs-obj-setting"></span><h4>setting<a class="headerlink" href="#setting" title="Permalink to this headline">¶</a></h4>
<p>The <tt class="docutils literal"><span class="pre">settings</span></tt> array specifies the context or the default (&#8220;master&#8221;) that is
then mapped to configurations.</p>
<p>The configurations for the <tt class="docutils literal"><span class="pre">&quot;master&quot;</span></tt> context are used when no context is given.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;master&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;specs&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="p">...</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="p">...</span>
<span class="p">]</span>
</pre></div>
</div>
<p>The context is specified in the <tt class="docutils literal"><span class="pre">settings</span></tt> array of the configuration object.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[</span>
  <span class="p">...</span>
  <span class="p">{</span>
    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;environment:development&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;specs&quot;</span><span class="o">:</span> <span class="p">{</span>
     <span class="p">...</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="p">...</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Compound contexts are specified in the settings array as a series of contexts
separated by commas as seen below.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[</span>
  <span class="p">...</span>
  <span class="p">{</span>
    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;environment:development&quot;</span><span class="p">,</span> <span class="s2">&quot;device:android&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;specs&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="p">...</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="p">...</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;master&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;master_route&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="p">...</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;environment:development&quot;</span><span class="p">],</span>
    <span class="s2">&quot;dev_route&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="p">...</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="specs">
<span id="context-configs-obj-specs"></span><h4>specs<a class="headerlink" href="#specs" title="Permalink to this headline">¶</a></h4>
<p>The <tt class="docutils literal"><span class="pre">specs</span></tt> object contains the mojit instances associated with a context.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[</span>
  <span class="p">...</span>
  <span class="p">{</span>
    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;environment:production&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;specs&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;photos&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;PhotoMojit&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="p">...</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="config">
<span id="context-configs-obj-config"></span><h4>config<a class="headerlink" href="#config" title="Permalink to this headline">¶</a></h4>
<p>The <tt class="docutils literal"><span class="pre">config</span></tt> object stores configuration for a mojit that is mapped to the context.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[</span>
  <span class="p">...</span>
  <span class="p">{</span>
    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;device:iphone&quot;</span><span class="p">],</span>
    <span class="s2">&quot;specs&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;iphone&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;iPhoneMojit&quot;</span><span class="p">,</span>
        <span class="s2">&quot;config&quot;</span><span class="o">:</span> <span class="p">{</span>
          <span class="s2">&quot;viewport_width&quot;</span><span class="o">:</span> <span class="mi">320</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="p">...</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="examples">
<span id="context-configs-define-exs"></span><h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<div class="section" id="application-json">
<span id="context-configs-exs-applicationjson"></span><h4>application.json<a class="headerlink" href="#application-json" title="Permalink to this headline">¶</a></h4>
<p>The configuration objects in <tt class="docutils literal"><span class="pre">application.json</span></tt> below define default
configurations and three context configurations. The last context configuration
contains two strings containing key-value pairs and is, thus, called a compound
context configuration.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;master&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;specs&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;mainPage&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;TestMojit&quot;</span>
        <span class="s2">&quot;config&quot;</span><span class="o">:</span> <span class="p">{</span>
          <span class="s2">&quot;env&quot;</span><span class="o">:</span> <span class="s2">&quot;This is the default environment.&quot;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;environment:development&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;specs&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;mainPage&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;TestMojit&quot;</span><span class="p">,</span>
        <span class="s2">&quot;config&quot;</span><span class="o">:</span> <span class="p">{</span>
          <span class="s2">&quot;env&quot;</span><span class="o">:</span> <span class="s2">&quot;I am in the development environment.&quot;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;environment:production&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;specs&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;mainPage&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;TestMojit&quot;</span><span class="p">,</span>
        <span class="s2">&quot;config&quot;</span><span class="o">:</span> <span class="p">{</span>
          <span class="s2">&quot;env&quot;</span><span class="o">:</span> <span class="s2">&quot;I am in the production environment.&quot;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;environment:production&quot;</span><span class="p">,</span> <span class="s2">&quot;device:kindle&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;specs&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;mainPage&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;TestMojit&quot;</span><span class="p">,</span>
        <span class="s2">&quot;config&quot;</span><span class="o">:</span> <span class="p">{</span>
          <span class="s2">&quot;env&quot;</span><span class="o">:</span> <span class="s2">&quot;I am in the production environment for Kindles.&quot;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="defaults-json">
<span id="context-config-exs-defaults-json"></span><h4>defaults.json<a class="headerlink" href="#defaults-json" title="Permalink to this headline">¶</a></h4>
<p>The configuration <tt class="docutils literal"><span class="pre">gamma</span></tt> in the example <tt class="docutils literal"><span class="pre">defaults.json</span></tt> below is mapped
to contexts for languages.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;master&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;config&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;alpha&quot;</span> <span class="o">:</span> <span class="s2">&quot;I am the first!&quot;</span><span class="p">,</span>
      <span class="s2">&quot;beta&quot;</span> <span class="o">:</span> <span class="s2">&quot;I am the second!&quot;</span><span class="p">,</span>
      <span class="s2">&quot;gamma&quot;</span><span class="o">:</span> <span class="s2">&quot;I am the third!&quot;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;lang:de&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;config&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;gamma&quot;</span><span class="o">:</span> <span class="s2">&quot;I am (when lang=de is passed) the third!&quot;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;lang:fr&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;config&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;gamma&quot;</span><span class="o">:</span> <span class="s2">&quot;defaults.json - (when lang=fr is passed) the third!&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="routes-json">
<span id="context-configs-exs-routesjson"></span><h4>routes.json<a class="headerlink" href="#routes-json" title="Permalink to this headline">¶</a></h4>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;master&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;prod_route&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;verbs&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">],</span>
      <span class="s2">&quot;path&quot;</span><span class="o">:</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
      <span class="s2">&quot;call&quot;</span><span class="o">:</span> <span class="s2">&quot;hello.index&quot;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;environment:development&quot;</span><span class="p">],</span>
    <span class="s2">&quot;dev_route&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;verbs&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">],</span>
      <span class="s2">&quot;path&quot;</span> <span class="o">:</span> <span class="s2">&quot;/testing&quot;</span><span class="p">,</span>
      <span class="s2">&quot;call&quot;</span> <span class="o">:</span> <span class="s2">&quot;dev_hello.index&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="static-configurations">
<span id="context-configs-define-static"></span><h2>Static Configurations<a class="headerlink" href="#static-configurations" title="Permalink to this headline">¶</a></h2>
<p>Certain context configurations can only be set once by the base context.
In other words, once the application starts with a given base context, the
values for certain configurations are static: they will not change until
the application is started with another base context that&#8217;s either
specified on the command line or configured in the <tt class="docutils literal"><span class="pre">server.js</span></tt> file.</p>
<p>The following configurations are static:</p>
<ul class="simple">
<li><a class="reference external" href="../intro/mojito_configuring.html#configuration-object">actionTimeout</a></li>
<li><a class="reference external" href="../intro/mojito_configuring.html#configuration-object">appPort</a></li>
<li><a class="reference external" href="../intro/mojito_configuring.html#builds-object">builds</a> - (only used by the <tt class="docutils literal"><span class="pre">mojito</span> <span class="pre">build</span></tt> command)</li>
<li><a class="reference external" href="../intro/mojito_configuring.html#configuration-object">middleware</a></li>
<li><a class="reference external" href="../intro/mojito_configuring.html#configuration-object">mojitDirs</a></li>
<li><a class="reference external" href="../intro/mojito_configuring.html#configuration-object">mojitsDirs</a></li>
<li><a class="reference external" href="../intro/mojito_configuring.html#configuration-object">routesFiles</a></li>
<li><a class="reference external" href="../intro/mojito_configuring.html#statichandling-object">staticHandling</a></li>
<li><a class="reference external" href="../intro/mojito_configuring.html#configuration-object">tunnelPrefix</a></li>
<li><a class="reference external" href="../intro/mojito_configuring.html#viewengine-object">viewEngine</a></li>
<li><a class="reference external" href="../intro/mojito_configuring.html#yui-object">yui</a></li>
</ul>
<p>For example, based on the configurations defined in the example <tt class="docutils literal"><span class="pre">application.json</span></tt>
below, after you set the base context <tt class="docutils literal"><span class="pre">&quot;environment:development&quot;</span></tt> with the
command <tt class="docutils literal"><span class="pre">$</span> <span class="pre">mojito</span> <span class="pre">start</span> <span class="pre">--context</span> <span class="pre">&quot;environment:development&quot;</span></tt>, your
application can only listen to requests on port 8000.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;master&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;appPort&quot;</span><span class="o">:</span> <span class="mi">8666</span><span class="p">,</span>
    <span class="s2">&quot;specs&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="p">...</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;environment:development&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;appPort&quot;</span><span class="o">:</span> <span class="mi">8000</span><span class="p">,</span>
    <span class="s2">&quot;specs&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="p">...</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;environment:production&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;appPort&quot;</span><span class="o">:</span> <span class="mi">80</span><span class="p">,</span>
    <span class="s2">&quot;specs&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="p">...</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="p">...</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="dynamically-changing-configurations">
<span id="context-configs-dynamic"></span><h2>Dynamically Changing Configurations<a class="headerlink" href="#dynamically-changing-configurations" title="Permalink to this headline">¶</a></h2>
<p>You may dynamically change the configurations for any context by having a parent
mojit execute a child mojit with new configurations. This is different than
getting different configurations by requesting a new context or specifying a
different base context. Regardless of the context being used, you can use the
same context and change the configurations by executing a child mojit with
new configurations. The parent mojit uses the <tt class="docutils literal"><span class="pre">execute</span></tt> method of the
<a class="reference external" href="../../api/classes/Composite.common.html">Composite addon</a> to execute the
child mojit. Let&#8217;s look at an example to see how it works.</p>
<p>In the example controller below, if the <tt class="docutils literal"><span class="pre">child</span></tt> parameter is found in the
routing, query string, or request body, a child instance with its own
configuration is executed, allowing the application to add new or change
configurations of the current context.</p>
<div class="highlight-javascript"><pre>YUI.add('TestMojit', function(Y, NAME) {
  Y.namespace('mojito.controllers')[NAME] = {
    index: function(ac) {
      var cfg = {
        children: {
          "one": {
            "type": "Child",
            "action": "index",
            "config": {
              "alpha": "Creating a new 'alpha' key or replacing the value of the alpha
                       key mapped to the context being used. The context, however, does
                       not change."
            }
          }
        }
      };
      var child = ac.params.getFromMerged('child');
      if (child){
        ac.composite.execute(cfg, function (data,meta){
          ac.done(data["one"]);
        });
      } else{
        ac.done(
          'config key "alpha": ' + ac.config.get('alpha', '[alpha not found]')
        );
      }
    }
  };
}, '0.0.1', {requires: ['mojito', 'mojito-config-addon', 'mojito-params-addon', mojito-composite-addon']});</pre>
</div>
</div>
<div class="section" id="creating-custom-contexts">
<span id="context-configs-custom"></span><h2>Creating Custom Contexts<a class="headerlink" href="#creating-custom-contexts" title="Permalink to this headline">¶</a></h2>
<p>The Mojito framework defines default contexts that developers can map
configurations to. These default contexts are defined in the file
<a class="reference external" href="https://github.com/yahoo/mojito/blob/develop/source/lib/dimensions.json">dimensions.json</a>
found in the Mojito source code. Developers can create an application-level
<tt class="docutils literal"><span class="pre">dimensions.json</span></tt> to define custom contexts that can be mapped to configurations
as well.</p>
<p>The local <tt class="docutils literal"><span class="pre">dimensions.json</span></tt> replaces the Mojito&#8217;s <tt class="docutils literal"><span class="pre">dimensions.json</span></tt>, so to
create custom contexts, you will need to copy Mojito&#8217;s <tt class="docutils literal"><span class="pre">dimension.json</span></tt> to
your application directory and then add your custom contexts to the file.
Defining and applying configurations for custom contexts is done in the same
way as for default contexts.</p>
<div class="section" id="who-should-create-custom-contexts">
<span id="context-configs-custom-create"></span><h3>Who Should Create Custom Contexts?<a class="headerlink" href="#who-should-create-custom-contexts" title="Permalink to this headline">¶</a></h3>
<p>Developers who create applications that require a degree of personalization
that extends beyond language and device would be good candidates to create
custom contexts. Before beginning to create your own <tt class="docutils literal"><span class="pre">dimensions.json</span></tt> file,
you should review the <a class="reference internal" href="#contexts-predefined"><em>Mojito Predefined Contexts</em></a> to make sure that you truly
need custom contexts.</p>
</div>
<div class="section" id="dimensions-file">
<span id="context-configs-custom-dimensions"></span><h3>Dimensions File<a class="headerlink" href="#dimensions-file" title="Permalink to this headline">¶</a></h3>
<p>The key-value pairs of the context are defined in the <tt class="docutils literal"><span class="pre">dimensions.json</span></tt>
file in the application directory. Once contexts are defined in the
<tt class="docutils literal"><span class="pre">dimensions.file</span></tt>, you can then map configurations to those contexts.
If your application has configurations for a context that has not been
defined by Mojito or at the application level in <tt class="docutils literal"><span class="pre">dimensions.json</span></tt>,
an error will prevent you from starting the application.</p>
<div class="section" id="syntax-for-javascript-object">
<span id="dimensions-syntax"></span><h4>Syntax for JavaScript Object<a class="headerlink" href="#syntax-for-javascript-object" title="Permalink to this headline">¶</a></h4>
<p>In the <tt class="docutils literal"><span class="pre">dimension.json</span></tt> file, the <tt class="docutils literal"><span class="pre">dimensions</span></tt> array contains JavaScript
objects that define the contexts. The keys of the context are the names of
the objects, and the values are the object&#8217;s properties as seen below.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">&quot;dimensions&quot;</span><span class="o">:</span><span class="p">[</span>
      <span class="p">{</span>
        <span class="s2">&quot;region&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;us&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="s2">&quot;jp&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="s2">&quot;cn&quot;</span><span class="o">:</span> <span class="kc">null</span>
      <span class="p">},</span>
      <span class="p">...</span>
     <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="example-dimensions-js">
<span id="dimensions-ex"></span><h4>Example dimensions.js<a class="headerlink" href="#example-dimensions-js" title="Permalink to this headline">¶</a></h4>
<p>Based on the example <tt class="docutils literal"><span class="pre">dimensions.json</span></tt> below, the following are
valid contexts:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">&quot;account_type:basic&quot;</span></tt></li>
<li><tt class="docutils literal"><span class="pre">&quot;account_type:premium&quot;</span></tt></li>
<li><tt class="docutils literal"><span class="pre">&quot;account_type:basic,region:us&quot;</span></tt></li>
<li><tt class="docutils literal"><span class="pre">&quot;account_type:premium,region:fr&quot;</span></tt></li>
</ul>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">&quot;dimensions&quot;</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">...</span>
      <span class="p">{</span>
        <span class="s2">&quot;account_type&quot;</span><span class="o">:</span> <span class="p">{</span>
          <span class="s2">&quot;basic&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
          <span class="s2">&quot;premium&quot;</span><span class="o">:</span> <span class="kc">null</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s2">&quot;region&quot;</span><span class="o">:</span><span class="p">{</span>
          <span class="s2">&quot;us&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
          <span class="s2">&quot;gb&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
          <span class="s2">&quot;fr&quot;</span><span class="o">:</span> <span class="kc">null</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="p">...</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>

   </div>

