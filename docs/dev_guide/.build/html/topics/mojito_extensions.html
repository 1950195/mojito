

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
     <title>Extending Mojito</title>
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '',
        COLLAPSE_INDEX: true,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/theme_extras.js"></script>
   </head> 

     <div class="header"><h1 class="heading"><a href="#">
          <span>Mojito</span></a></h1>
      </div>
      <div class="topnav">
        <p>
        <a class="uplink" href="../">Mojito Documentation</a>
        &#160;&#160;::&#160;&#160;
        <a href="../index.html" title="Mojito">Mojito</a>
        &#160;&#160;::&#160;&#160;
        
           <a href="mojito_frame_mojits.html">Frame Mojits</a>
        &#160;&#160;::&#160;&#160;
        
        
           <a href="mojito_using_contexts.html">Using Context Configurations</a>
        
        </p>

      </div>
      <div class="content">
   <div class="section" id="extending-mojito">
<h1>Extending Mojito<a class="headerlink" href="#extending-mojito" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<span id="mojito-extending-intro"></span><h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The Mojito framework lets you add features and extend functionality through
addons, libraries, and middleware. This chapter discusses how to create
extensions and where to place files in the Mojito
framework.</p>
</div>
<div class="section" id="addons">
<span id="mojito-extending-addons"></span><h2>Addons<a class="headerlink" href="#addons" title="Permalink to this headline">¶</a></h2>
<p>In addition to the <a class="reference external" href="../../api/classes/ActionContext.html">Action Context</a>
addons that Mojito provides, you can create your own addons to add functionality
to controller actions.</p>
<p>Addons allows you to do the following:</p>
<ul class="simple">
<li>wrap third-party Node.js libraries and YUI libraries</li>
<li>inspect the content of the <tt class="docutils literal"><span class="pre">ActionContext</span></tt> object</li>
<li>call methods on the <tt class="docutils literal"><span class="pre">ActionContext</span></tt> object, which can be references through
<tt class="docutils literal"><span class="pre">this.get('host')</span></tt></li>
</ul>
<div class="section" id="creating-new-addons">
<span id="addons-creating"></span><h3>Creating New Addons<a class="headerlink" href="#creating-new-addons" title="Permalink to this headline">¶</a></h3>
<p>An addon is simply a JavaScript file that contains a YUI module. You can create
addons at the application and mojit level. Application-level addons are
available to all mojits in the application, whereas, mojit-level addons are
only available to its mojit.</p>
<div class="section" id="naming-convention">
<span id="extending-addons-naming"></span><h4>Naming Convention<a class="headerlink" href="#naming-convention" title="Permalink to this headline">¶</a></h4>
<p>The name of an addon should have the following syntax where <tt class="docutils literal"><span class="pre">{addon_namespace}</span></tt>
is the namespace of the addon and <tt class="docutils literal"><span class="pre">{affinity}</span></tt> is
<tt class="docutils literal"><span class="pre">server</span></tt>, <tt class="docutils literal"><span class="pre">common</span></tt>, or <tt class="docutils literal"><span class="pre">client</span></tt>.</p>
<p><tt class="docutils literal"><span class="pre">{addon_namespace}.{affinity}.js</span></tt></p>
</div>
<div class="section" id="location-of-addons">
<span id="extending-addons-loc"></span><h4>Location of Addons<a class="headerlink" href="#location-of-addons" title="Permalink to this headline">¶</a></h4>
<p>Application-level addons should be placed in the following directory:</p>
<p><tt class="docutils literal"><span class="pre">{app_dir}/addons/ac/</span></tt></p>
<p>Mojit-level addons should be placed in the following directory:</p>
<p><tt class="docutils literal"><span class="pre">{mojit_dir}/addons/ac/</span></tt></p>
</div>
<div class="section" id="namespace-of-addon">
<span id="extending-addons-namespace"></span><h4>Namespace of Addon<a class="headerlink" href="#namespace-of-addon" title="Permalink to this headline">¶</a></h4>
<p>To access addon methods and properties, you use the Action Context object
(i.e., <tt class="docutils literal"><span class="pre">ac</span></tt>) and the addon namespace. For example, the namespace of the
addon <tt class="docutils literal"><span class="pre">addons/ac/foo.common.js</span></tt> would be <tt class="docutils literal"><span class="pre">foo</span></tt>.  Thus, to call the method
<tt class="docutils literal"><span class="pre">save</span></tt> of the <tt class="docutils literal"><span class="pre">foo</span></tt> addon, you would use <tt class="docutils literal"><span class="pre">ac.foo.save</span></tt>.</p>
<p>See <a class="reference internal" href="#extending-addons-using"><em>Using Your Addon</em></a> for an example
of how to call methods from the addon namespace.</p>
</div>
<div class="section" id="writing-the-addon">
<span id="extending-addons-writing"></span><h4>Writing the Addon<a class="headerlink" href="#writing-the-addon" title="Permalink to this headline">¶</a></h4>
<p>The ActionContext object and ActionContext addons simulate the
<a class="reference external" href="http://developer.yahoo.com/yui/3/base/">YUI Base</a> and
<a class="reference external" href="http://developer.yahoo.com/yui/3/plugin/">YUI Plugin</a> infrastructure, so
creating a new addon is similar to creating a new YUI Plugin.</p>
<p>The addon must do the following:</p>
<ul class="simple">
<li>register a plugin name, which is the string passed to <tt class="docutils literal"><span class="pre">YUI.add</span></tt></li>
<li>constructor with a <tt class="docutils literal"><span class="pre">prototype</span></tt> property</li>
<li>assign the constructor to a namespace of <tt class="docutils literal"><span class="pre">Y.mojito.addons.ac</span></tt>,
so Mojito can access your addon</li>
<li>require the &#8216;mojito&#8217; module, otherwise the namespace <tt class="docutils literal"><span class="pre">Y.mojito.addons.ac</span></tt> might
not be available (unless you use <tt class="docutils literal"><span class="pre">Y.namespace()</span></tt>).</li>
</ul>
<p><strong>Optional:</strong> <tt class="docutils literal"><span class="pre">requires</span></tt> array to include other modules.
The code snippet below shows the skeleton of an addon with the registered
plugin name (<tt class="docutils literal"><span class="pre">'addon-ac-cheese'</span></tt>), the constructor (<tt class="docutils literal"><span class="pre">CheeseAcAddon</span></tt>) with its
<tt class="docutils literal"><span class="pre">prototype</span></tt> property, and requires the <tt class="docutils literal"><span class="pre">mojito</span></tt> module.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="c1">// Register the plugin name (must be unique)</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;addon-ac-cheese&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">NAME</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Constructor for addon</span>
  <span class="kd">function</span> <span class="nx">CheeseAcAddon</span><span class="p">(</span><span class="nx">command</span><span class="p">,</span> <span class="nx">adapter</span><span class="p">,</span> <span class="nx">ac</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// The &quot;command&quot; is the Mojito internal details</span>
    <span class="c1">// for the dispatch of the mojit instance.</span>
    <span class="c1">// The &quot;adapter&quot; is the output adapter, containing</span>
    <span class="c1">// the &quot;done()&quot;, &quot;error()&quot;, etc, methods.</span>
    <span class="c1">// The &quot;ac&quot; is the ActionContext object to which</span>
    <span class="c1">// this addon is about to be attached.</span>
  <span class="p">}</span>
  <span class="c1">// Use the prototype property to add</span>
  <span class="c1">// methods and other properties</span>
  <span class="nx">CheeseAcAddon</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// Put methods and properties here</span>
  <span class="p">}</span>
  <span class="c1">// Assign the constructor of the addon to a</span>
  <span class="c1">// namespace of Y.mojito.addons.ac</span>
  <span class="nx">Y</span><span class="p">.</span><span class="nx">mojito</span><span class="p">.</span><span class="nx">addons</span><span class="p">.</span><span class="nx">ac</span><span class="p">.</span><span class="nx">cheese</span> <span class="o">=</span> <span class="nx">CheeseAcAddon</span><span class="p">;</span>
  <span class="c1">// Optional: &#39;requires&#39; array could include other</span>
  <span class="c1">// YUI modules if needed.</span>
<span class="p">},</span> <span class="s1">&#39;0.0.1&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">requires</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;mojito&#39;</span><span class="p">]});</span>
</pre></div>
</div>
</div>
<div class="section" id="example-addon">
<span id="extending-addons-writing-ex"></span><h4>Example Addon<a class="headerlink" href="#example-addon" title="Permalink to this headline">¶</a></h4>
<p>In the example addon <tt class="docutils literal"><span class="pre">cheese.common.js</span></tt> below, the <tt class="docutils literal"><span class="pre">YUI.add</span></tt> method
registers the <tt class="docutils literal"><span class="pre">addon-ac-cheese</span></tt> plugin. The addon namespace
is <tt class="docutils literal"><span class="pre">cheese</span></tt>, and the addon has the one method <tt class="docutils literal"><span class="pre">cheesify</span></tt>, which is
added through the <tt class="docutils literal"><span class="pre">prototype</span></tt> property.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;addon-ac-cheese&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">NAME</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">CheeseAcAddon</span><span class="p">(</span><span class="nx">command</span><span class="p">,</span> <span class="nx">adapter</span><span class="p">,</span> <span class="nx">ac</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// The &quot;command&quot; is the Mojito internal details</span>
    <span class="c1">// for the dispatch of the mojit instance.</span>
    <span class="c1">// The &quot;adapter&quot; is the output adapter, containing</span>
    <span class="c1">// the &quot;done()&quot;, &quot;error()&quot;, etc, methods.</span>
    <span class="c1">// The &quot;ac&quot; is the ActionContext object to which</span>
    <span class="c1">// this addon is about to be attached.</span>
  <span class="p">}</span>
  <span class="nx">CheeseAcAddon</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1">// The &quot;namespace&quot; is where in the ActionContext</span>
    <span class="c1">// the user can find this addon. The namespace</span>
    <span class="c1">// must be the same as the first part of the addon file.</span>
    <span class="c1">// Thus, this addon file must be named &#39;cheese&#39;.{affinity}.js&#39;</span>
    <span class="nx">namespace</span><span class="o">:</span> <span class="s1">&#39;cheese&#39;</span><span class="p">,</span>
    <span class="nx">cheesify</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">n</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">Lang</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">obj</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;cheesy &#39;</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">n</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">n</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">obj</span><span class="p">[</span><span class="nx">n</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">cheesify</span><span class="p">(</span><span class="nx">obj</span><span class="p">[</span><span class="nx">n</span><span class="p">]);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">obj</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="c1">// If this addon depends on another, that can</span>
  <span class="c1">// be specified here. Circular dependencies are not</span>
  <span class="c1">// supported or automatically detected,</span>
  <span class="c1">// so please be careful.</span>
  <span class="nx">CheeseAcAddon</span><span class="p">.</span><span class="nx">dependsOn</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;http&#39;</span><span class="p">];</span>
  <span class="nx">Y</span><span class="p">.</span><span class="nx">mojito</span><span class="p">.</span><span class="nx">addons</span><span class="p">.</span><span class="nx">ac</span><span class="p">.</span><span class="nx">cheese</span> <span class="o">=</span> <span class="nx">CheeseAcAddon</span><span class="p">;</span>
<span class="p">},</span> <span class="s1">&#39;0.0.1&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">requires</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;mojito&#39;</span><span class="p">]});</span>
</pre></div>
</div>
</div>
<div class="section" id="using-your-addon">
<span id="extending-addons-using"></span><h4>Using Your Addon<a class="headerlink" href="#using-your-addon" title="Permalink to this headline">¶</a></h4>
<p>The addon in <a class="reference internal" href="#example-addon">Example Addon</a> registered the plugin <tt class="docutils literal"><span class="pre">addon-ac-cheese</span></tt> and
made its constructor available through the namespace <tt class="docutils literal"><span class="pre">cheese</span></tt>. This namespace
must match the first part of the addon file name, so the addon file name is
<tt class="docutils literal"><span class="pre">cheese.common.js</span></tt>.</p>
<p>Addons are not automatically added to the ActionContext, so to access an
addon, your controller needs to add the YUI plugin name to the <tt class="docutils literal"><span class="pre">requires</span></tt>
array. The YUI plugin name is the string passed to <tt class="docutils literal"><span class="pre">YUI.add</span></tt> in the addon.
To invoke the addon methods, you use the Action Context object (<tt class="docutils literal"><span class="pre">ac</span></tt>) with
the addon namespace: <tt class="docutils literal"><span class="pre">ac.cheese.{addon_method}</span></tt></p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;Foo&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">NAME</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">Y</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s1">&#39;mojito.controllers&#39;</span><span class="p">)[</span><span class="nx">NAME</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">index</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ac</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Use the namespace defined by the</span>
      <span class="c1">// addon file name (&#39;cheese&#39;) with</span>
      <span class="c1">// the addon function &#39;cheesify&#39;</span>
      <span class="kd">var</span> <span class="nx">cheesy</span> <span class="o">=</span> <span class="nx">ac</span><span class="p">.</span><span class="nx">cheese</span><span class="p">.</span><span class="nx">cheesify</span><span class="p">({</span>
        <span class="nx">food</span><span class="o">:</span> <span class="s2">&quot;nachos&quot;</span><span class="p">,</span>
        <span class="nx">things</span><span class="o">:</span> <span class="s2">&quot;jokes&quot;</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="c1">// To use your addon, add &#39;addon-ac-cheese&#39; to your</span>
  <span class="c1">// &#39;requires&#39; array.</span>
<span class="p">},</span> <span class="s1">&#39;0.0.1&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">requires</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;mojito&#39;</span><span class="p">,</span> <span class="s1">&#39;addon-ac-cheese&#39;</span><span class="p">]});</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="middleware">
<span id="mojito-extending-middleware"></span><h2>Middleware<a class="headerlink" href="#middleware" title="Permalink to this headline">¶</a></h2>
<div class="section" id="extending-middleware-intro">
<span id="id1"></span><h3>Introduction<a class="headerlink" href="#extending-middleware-intro" title="Permalink to this headline">¶</a></h3>
<p>Middleware is code that can handle (or modify) the HTTP request in the server.
Because Mojito middleware is based on the HTTP middleware
<a class="reference external" href="http://senchalabs.github.com/connect/">Connect</a>,  the code must follow
the Connect API. Also, because each piece of middleware is a Node.js module, it
should use <tt class="docutils literal"><span class="pre">module.exports</span></tt> to create a function to handle incoming requests.</p>
</div>
<div class="section" id="configuring-middleware">
<span id="extending-middleware-configure"></span><h3>Configuring Middleware<a class="headerlink" href="#configuring-middleware" title="Permalink to this headline">¶</a></h3>
<p>To use middleware, the path to its code must be listed in the <tt class="docutils literal"><span class="pre">middleware</span></tt>
array in <tt class="docutils literal"><span class="pre">application.json</span></tt>. The path can be marked as relative to the
application by prefixing it with &#8221;./&#8221;.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;master&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;middleware&quot;</span><span class="o">:</span> <span class="p">[</span>
      <span class="s2">&quot;./middleware/static.js&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;specs&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;hello&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;HelloMojit&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="location-of-middleware">
<span id="extending-middleware-location"></span><h3>Location of Middleware<a class="headerlink" href="#location-of-middleware" title="Permalink to this headline">¶</a></h3>
<p>We suggest that middleware be located in the directory <tt class="docutils literal"><span class="pre">{app_dir}/middleware/</span></tt>,
but this is only a convention and not required. The name of the file is not important.</p>
</div>
<div class="section" id="example">
<span id="extending-middleware-example"></span><h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>The simple example below of middleware intercepts an HTTP request and lowercases
URLs containing the string &#8220;<a href="#id9"><span class="problematic" id="id10">module_</span></a>&#8221; before the URLs are received by the server.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;module_&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="nx">next</span><span class="p">();</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="libraries">
<span id="mojito-extending-libraries"></span><h2>Libraries<a class="headerlink" href="#libraries" title="Permalink to this headline">¶</a></h2>
<p>Mojito allows you to use YUI libraries, external libraries, or customized
libraries. To use any library in Mojito, you need to specify the module in
either the <tt class="docutils literal"><span class="pre">requires</span></tt> array in the controller for YUI libraries or by using
the <tt class="docutils literal"><span class="pre">require</span></tt> method for Node.js modules.</p>
<div class="section" id="yui-library">
<span id="extending-libraries-yui"></span><h3>YUI Library<a class="headerlink" href="#yui-library" title="Permalink to this headline">¶</a></h3>
<p>YUI libraries can be made available at the application or the mojit level.
Each file can only have one <tt class="docutils literal"><span class="pre">YUI.add</span></tt> statement. Other components, such
as controllers, models, etc., needing the library should specify the YUI
module name in the <tt class="docutils literal"><span class="pre">requires</span></tt> array.</p>
<div class="section" id="file-naming-convention">
<span id="libraries-yui-naming"></span><h4>File Naming Convention<a class="headerlink" href="#file-naming-convention" title="Permalink to this headline">¶</a></h4>
<p>The file name of a YUI module should have the following syntax where
<tt class="docutils literal"><span class="pre">{yui_mod_name}</span></tt> is a unique YUI module name defined by the user and
<tt class="docutils literal"><span class="pre">{affinity}</span></tt> is <tt class="docutils literal"><span class="pre">server</span></tt>, <tt class="docutils literal"><span class="pre">common</span></tt>, or <tt class="docutils literal"><span class="pre">client</span></tt>.</p>
<p><tt class="docutils literal"><span class="pre">{yui_mod_name}.{affinity}.js</span></tt></p>
</div>
<div class="section" id="location-of-yui-modules">
<span id="libraries-yui-loc"></span><h4>Location of YUI Modules<a class="headerlink" href="#location-of-yui-modules" title="Permalink to this headline">¶</a></h4>
<p>Application-level YUI modules should be placed in the following directory:</p>
<p><tt class="docutils literal"><span class="pre">{app_dir}/yui_modules/</span></tt></p>
<p>Mojit-level YUI modules should be placed in the following directory:</p>
<p><tt class="docutils literal"><span class="pre">{mojit_dir}/yui_modules/</span></tt></p>
</div>
<div class="section" id="using-the-yui-module">
<span id="libraries-yui-using"></span><h4>Using the YUI Module<a class="headerlink" href="#using-the-yui-module" title="Permalink to this headline">¶</a></h4>
<p>In the sections below, we provide an example YUI module and then show how
to require and use that YUI module from a controller.</p>
<div class="section" id="hello-uid-module">
<span id="yui-using-hello-uid"></span><h5>hello-uid Module<a class="headerlink" href="#hello-uid-module" title="Permalink to this headline">¶</a></h5>
<p>In the code example below, the <tt class="docutils literal"><span class="pre">create_id</span></tt> function becomes the constructor
for the <tt class="docutils literal"><span class="pre">UID</span></tt> namespace. This will let you create an instance, and the
<tt class="docutils literal"><span class="pre">prototype</span></tt> object then allows you to access the method <tt class="docutils literal"><span class="pre">log</span></tt> from that
instance.</p>
<p><tt class="docutils literal"><span class="pre">{mojit_dir}/yui_modules/hello-uid.server.js</span></tt></p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;hello-uid&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">){</span>
  <span class="kd">function</span> <span class="nx">create_id</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">uid</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">10000000</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">uid</span> <span class="o">=</span> <span class="nx">uid</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">create_id</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">log</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">user_name</span><span class="p">){</span>
      <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">user_name</span> <span class="o">+</span> <span class="s2">&quot;&#39;s UID is &quot;</span> <span class="o">+</span> <span class="s1">&#39;[&#39;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">uid</span><span class="o">+</span><span class="s1">&#39;]&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="nx">Y</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s1">&#39;mojito&#39;</span><span class="p">).</span><span class="nx">UID</span> <span class="o">=</span> <span class="nx">create_id</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="using-the-hello-uid-module">
<h5>Using the hello-uid Module<a class="headerlink" href="#using-the-hello-uid-module" title="Permalink to this headline">¶</a></h5>
<p>In the example mojit controller below, the YUI module <tt class="docutils literal"><span class="pre">hello-uid</span></tt> is loaded
because the module is in the <tt class="docutils literal"><span class="pre">requires</span></tt> array. The <tt class="docutils literal"><span class="pre">log</span></tt> method can then be
called from an instance (i.e., <tt class="docutils literal"><span class="pre">uid</span></tt>) of the module.</p>
<p><tt class="docutils literal"><span class="pre">{mojit_dir}/controller.server.js</span></tt></p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;HelloMojit&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">NAME</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">Y</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s1">&#39;mojito.controllers&#39;</span><span class="p">)[</span><span class="nx">NAME</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">index</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ac</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">user_name</span> <span class="o">=</span> <span class="nx">ac</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">getFromMerged</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="s2">&quot;User&quot;</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">uid</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">mojito</span><span class="p">.</span><span class="nx">UID</span><span class="p">();</span>
      <span class="nx">uid</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">user_name</span><span class="p">);</span>
      <span class="nx">ac</span><span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="s1">&#39;Hello World!&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">},</span> <span class="s1">&#39;0.0.1&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">requires</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;hello-uid&#39;</span><span class="p">]});</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="other-libraries">
<span id="extending-libraries-other"></span><h3>Other Libraries<a class="headerlink" href="#other-libraries" title="Permalink to this headline">¶</a></h3>
<p>Non-YUI libraries can also be used at either the application or mojit level.
Because Node.js and <strong>not</strong> Mojito will read the contents of the library files,
you need to use the function <tt class="docutils literal"><span class="pre">require</span></tt> to include the library. Mojito will only confirm
that the files exist.</p>
<div class="section" id="location-of-non-yui-libraries">
<span id="libraries-other-loc"></span><h4>Location of Non-YUI Libraries<a class="headerlink" href="#location-of-non-yui-libraries" title="Permalink to this headline">¶</a></h4>
<p>Application-level libraries should be placed in the following directory:</p>
<p><tt class="docutils literal"><span class="pre">{app_dir}/libs/</span></tt></p>
<p>Mojit-level libraries should be placed in the following directory:</p>
<p><tt class="docutils literal"><span class="pre">{mojit_dir}/libs</span></tt></p>
</div>
</div>
</div>
<div class="section" id="view-engines">
<span id="mojito-extending-ve"></span><h2>View Engines<a class="headerlink" href="#view-engines" title="Permalink to this headline">¶</a></h2>
<div class="section" id="overview">
<span id="extending-ve-overview"></span><h3>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<p>A view engine is the piece of code that takes the data returned by a controller
and applies it to a view. This is most often done by interpreting the view as
a template. View engines in Mojito can be at either the application or mojit
level. Application-level view engines are available to all mojits.</p>
<p>The view engine consists of an addon that we will refer to as the view engine
addon to differentiate it from other addons. The view engine addon can include
code that renders templates or use a rendering engine, such as
<a href="#id11"><span class="problematic" id="id12">`Embedded JavaScript (EJS) http://embeddedjs.com/&gt;`_</span></a>, to render templates.
In the latter case, the view engine addon acts as an interface between the
Mojito framework and the rendering engine.</p>
<p>In the following sections, we will be discussing how to create a view engine
addon that relies on a rendering engine, not how to write code that renders
templates.</p>
<div class="section" id="terminology">
<span id="ve-overview-term"></span><h4>Terminology<a class="headerlink" href="#terminology" title="Permalink to this headline">¶</a></h4>
<p>The following list may help clarify the meaning of commonly used terms in this
section.</p>
<ul class="simple">
<li><strong>view engine</strong> - The code used to apply data to a view. In Mojito, the view
engine consists of a view engine addon.</li>
<li><strong>view engine addon</strong> - The Mojito addon that compiles and renders templates.
The addon typically relies on a rendering engine to compile and render templates,
but may include code to do the compilation and rendering.</li>
<li><strong>rendering engine</strong> - The rendering engine is typically off-the-shelf
technology, such as <a class="reference external" href="http://akdubya.github.com/dustjs">Dust</a>,
<a class="reference external" href="http://jade-lang.com/">Jade</a>, or <a class="reference external" href="http://embeddedjs.com/">EJS</a>, that
renders the template into markup for an HTML page.</li>
<li><strong>template</strong> - The template file (chosen by the controller) that contains
tags and HTML that is rendered into markup for an HTML page.</li>
</ul>
</div>
</div>
<div class="section" id="general-steps-for-creating-view-engines">
<span id="extending-ve-steps"></span><h3>General Steps for Creating View Engines<a class="headerlink" href="#general-steps-for-creating-view-engines" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Use <tt class="docutils literal"><span class="pre">npm</span></tt> to install the rendering engine into your Mojito application or
copy it into a directory such as <tt class="docutils literal"><span class="pre">{app_dir}/libs</span></tt>.</li>
<li>Create a view engine addon that references the rendering engine with a
<tt class="docutils literal"><span class="pre">require</span></tt> statement and
meets the <a class="reference internal" href="#reqs-ve-addon"><em>requirements of the view engine addon</em></a>.</li>
<li>Create templates using the templates for the rendering engine and place
them in <tt class="docutils literal"><span class="pre">{mojit_dir}/views</span></tt>.</li>
</ol>
</div>
<div class="section" id="file-naming-conventions">
<span id="extending-ve-naming"></span><h3>File Naming Conventions<a class="headerlink" href="#file-naming-conventions" title="Permalink to this headline">¶</a></h3>
<div class="section" id="view-engine-addon">
<span id="ve-naming-addon"></span><h4>View Engine Addon<a class="headerlink" href="#view-engine-addon" title="Permalink to this headline">¶</a></h4>
<p>The name of the addon should have the following syntax where <tt class="docutils literal"><span class="pre">{view_engine_name}</span></tt>
is the view engine and <tt class="docutils literal"><span class="pre">{affinity}</span></tt> is <tt class="docutils literal"><span class="pre">server</span></tt>, <tt class="docutils literal"><span class="pre">common</span></tt>, or <tt class="docutils literal"><span class="pre">client</span></tt>.</p>
<p><tt class="docutils literal"><span class="pre">{view_engine_name}.{affinity}.js</span></tt></p>
</div>
<div class="section" id="template">
<span id="ve-naming-template"></span><h4>Template<a class="headerlink" href="#template" title="Permalink to this headline">¶</a></h4>
<p>The name of the template should have the following syntax where
<tt class="docutils literal"><span class="pre">{view_engine_name}</span></tt> should be the same as the <tt class="docutils literal"><span class="pre">{view_engine_name}</span></tt> in
the file name of the view engine addon.</p>
<p><tt class="docutils literal"><span class="pre">{action}.{view_engine_name}.html</span></tt></p>
</div>
</div>
<div class="section" id="file-locations">
<span id="extending-ve-loc"></span><h3>File Locations<a class="headerlink" href="#file-locations" title="Permalink to this headline">¶</a></h3>
<div class="section" id="application-level-view-engine-addons">
<span id="ve-loc-app-level"></span><h4>Application-Level View Engine Addons<a class="headerlink" href="#application-level-view-engine-addons" title="Permalink to this headline">¶</a></h4>
<p><tt class="docutils literal"><span class="pre">{app_dir}/addons/view-engines</span></tt></p>
</div>
<div class="section" id="mojit-level-view-engine-addons">
<span id="ve-loc-mojit-level"></span><h4>Mojit-Level View Engine Addons<a class="headerlink" href="#mojit-level-view-engine-addons" title="Permalink to this headline">¶</a></h4>
<p><tt class="docutils literal"><span class="pre">{mojit_dir}/addons/view-engines</span></tt></p>
</div>
<div class="section" id="rendering-engines">
<span id="ve-loc-rendering"></span><h4>Rendering Engines<a class="headerlink" href="#rendering-engines" title="Permalink to this headline">¶</a></h4>
<p>Mojito does not require rendering engines to be in a specific location. The
recommended practice is to use <tt class="docutils literal"><span class="pre">npm</span></tt> to install rendering engines into
the <tt class="docutils literal"><span class="pre">node_modules</span></tt> directory or copy the rendering engine into the <tt class="docutils literal"><span class="pre">libs</span></tt>
directory as shown below:</p>
<p><tt class="docutils literal"><span class="pre">{app_dir}/node_modules/{rendering_engine}</span></tt></p>
<p><tt class="docutils literal"><span class="pre">{app_dir}/libs/{rendering_engine}</span></tt></p>
<p><tt class="docutils literal"><span class="pre">{mojit_dir}/libs/{rendering_engine}}</span></tt></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you are using mojit-level view engine addons, the rendering engine
should be at the mojit level as well, such as
<tt class="docutils literal"><span class="pre">{mojit_dir}/libs/{rendering_engine}</span></tt>.</p>
</div>
</div>
</div>
<div class="section" id="requirements-of-the-view-engine-addon">
<span id="reqs-ve-addon"></span><h3>Requirements of the View Engine Addon<a class="headerlink" href="#requirements-of-the-view-engine-addon" title="Permalink to this headline">¶</a></h3>
<p>The view engine addon must have the following:</p>
<ul>
<li><p class="first">a <tt class="docutils literal"><span class="pre">YUI.add</span></tt> statement to register the addon. For example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;addons-viewengine-ejs&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">NAME</span><span class="p">)</span> <span class="p">{</span>

  <span class="c1">// The addon name &#39;addons-viewengine-ejs&#39; is registered by YUI.add</span>

<span class="p">},</span> <span class="s1">&#39;0.1.0&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">requires</span><span class="o">:</span> <span class="p">[]});</span>
</pre></div>
</div>
</li>
<li><p class="first">an object that is assigned to <tt class="docutils literal"><span class="pre">Y.mojito.addons.viewEngines.{view_engine_name}</span></tt>
as seen below:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">...</span>
  <span class="kd">function</span> <span class="nx">EjsAdapter</span><span class="p">(</span><span class="nx">viewId</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewId</span> <span class="o">=</span> <span class="nx">viewId</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="p">...</span>
  <span class="nx">Y</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s1">&#39;mojito.addons.viewEngines&#39;</span><span class="p">).</span><span class="nx">ejs</span> <span class="o">=</span> <span class="nx">EjsAdapter</span><span class="p">;</span>
<span class="p">...</span>
</pre></div>
</div>
</li>
<li><p class="first">a prototype of the object has the following two methods <tt class="docutils literal"><span class="pre">render</span></tt> and <tt class="docutils literal"><span class="pre">compiler</span></tt>
as shown below:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">...</span>
  <span class="nx">EjsAdapter</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>

    <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">mojitType</span><span class="p">,</span> <span class="nx">tmpl</span><span class="p">,</span> <span class="nx">adapter</span><span class="p">,</span> <span class="nx">meta</span><span class="p">,</span> <span class="nx">more</span><span class="p">)</span> <span class="p">{</span>
      <span class="p">...</span>
    <span class="p">},</span>
    <span class="nx">compiler</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tmpl</span><span class="p">)</span> <span class="p">{</span>
       <span class="p">...</span>
    <span class="p">}</span>
<span class="p">...</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="methods-for-the-view-engine-addon">
<span id="reqs-ve-methods"></span><h3>Methods for the View Engine Addon<a class="headerlink" href="#methods-for-the-view-engine-addon" title="Permalink to this headline">¶</a></h3>
<div class="section" id="render">
<span id="ve-methods-render"></span><h4>render<a class="headerlink" href="#render" title="Permalink to this headline">¶</a></h4>
<div class="section" id="description">
<span id="ve-render-desc"></span><h5>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h5>
<p>Sends a rendered template as the first argument to the methods <tt class="docutils literal"><span class="pre">adapter.flush</span></tt>
or <tt class="docutils literal"><span class="pre">adapter.done</span></tt>.</p>
</div>
<div class="section" id="signature">
<span id="ve-render-sig"></span><h5>Signature<a class="headerlink" href="#signature" title="Permalink to this headline">¶</a></h5>
<p><tt class="docutils literal"><span class="pre">render(data,</span> <span class="pre">mojitType,</span> <span class="pre">tmpl,</span> <span class="pre">adapter,</span> <span class="pre">meta,</span> <span class="pre">more)</span></tt></p>
</div>
<div class="section" id="parameters">
<span id="ve-render-params"></span><h5>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">data</span></tt> (Object) - the data to render.</li>
<li><tt class="docutils literal"><span class="pre">mojitType</span></tt> (String) - the mojit whose view is being rendered.</li>
<li><tt class="docutils literal"><span class="pre">tmpl</span></tt> - (String) - path to template to render.</li>
<li><tt class="docutils literal"><span class="pre">adapter</span></tt> (Object) - the output adapter to use.</li>
<li><tt class="docutils literal"><span class="pre">meta</span></tt> (Object) - the metadata that should be passed as the second argument
to <tt class="docutils literal"><span class="pre">adapter.flush</span></tt>
or <tt class="docutils literal"><span class="pre">adapter.done</span></tt></li>
<li><tt class="docutils literal"><span class="pre">more</span></tt> (Boolean) - if <tt class="docutils literal"><span class="pre">true</span></tt>, the addon should call the method
<tt class="docutils literal"><span class="pre">adapter.flush</span></tt>, and if <tt class="docutils literal"><span class="pre">false</span></tt>, call the method <tt class="docutils literal"><span class="pre">adapter.done</span></tt>.</li>
</ul>
</div>
<div class="section" id="return">
<h5>Return<a class="headerlink" href="#return" title="Permalink to this headline">¶</a></h5>
<p>None</p>
</div>
</div>
<div class="section" id="compiler">
<span id="ve-methods-compiler"></span><h4>compiler<a class="headerlink" href="#compiler" title="Permalink to this headline">¶</a></h4>
<div class="section" id="ve-compiler-desc">
<span id="id2"></span><h5>Description<a class="headerlink" href="#ve-compiler-desc" title="Permalink to this headline">¶</a></h5>
<p>Returns the compiled template. The <tt class="docutils literal"><span class="pre">compiler</span></tt> method is only used when you
run the following command: <tt class="docutils literal"><span class="pre">mojito</span> <span class="pre">compile</span> <span class="pre">views</span></tt></p>
</div>
<div class="section" id="ve-compiler-sig">
<span id="id3"></span><h5>Signature<a class="headerlink" href="#ve-compiler-sig" title="Permalink to this headline">¶</a></h5>
<p><tt class="docutils literal"><span class="pre">compile(tmpl)</span></tt></p>
</div>
<div class="section" id="ve-compiler-params">
<span id="id4"></span><h5>Parameters<a class="headerlink" href="#ve-compiler-params" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">tmpl</span></tt> (String) - path to the template that is to be rendered</li>
</ul>
</div>
<div class="section" id="ve-compiler-return">
<span id="id5"></span><h5>Return<a class="headerlink" href="#ve-compiler-return" title="Permalink to this headline">¶</a></h5>
<p><tt class="docutils literal"><span class="pre">String</span></tt> - compiled template</p>
</div>
</div>
</div>
<div class="section" id="view-engine-addon-and-its-view">
<span id="ve-engine-view"></span><h3>View Engine Addon and Its View<a class="headerlink" href="#view-engine-addon-and-its-view" title="Permalink to this headline">¶</a></h3>
<p>A naming convention associates a view engine and its templates. For example,
the view engine <tt class="docutils literal"><span class="pre">{mojit_dir}/addons/view-engines/big_engine.server.js</span></tt> will
be used to render the template <tt class="docutils literal"><span class="pre">{mojit_dir}/views/foo.big_engine.html</span></tt>.
Having two templates that only differ by the view engine will cause an error
because Mojito will not be able to decide which view engine to use
(which to prioritize above the other) to render the template.</p>
</div>
<div class="section" id="ve-engine-ex">
<span id="id6"></span><h3>Example<a class="headerlink" href="#ve-engine-ex" title="Permalink to this headline">¶</a></h3>
<div class="section" id="embedded-javascript-ejs">
<span id="ve-engine-ex-ejs"></span><h4>Embedded JavaScript (EJS)<a class="headerlink" href="#embedded-javascript-ejs" title="Permalink to this headline">¶</a></h4>
<p>The following example is of the <a class="reference external" href="http://embeddedjs.com/">EJS view engine</a>.</p>
<div class="section" id="ejs-rendering-engine">
<span id="ve-engine-ex-ejs-engine"></span><h5>EJS Rendering Engine<a class="headerlink" href="#ejs-rendering-engine" title="Permalink to this headline">¶</a></h5>
<p>You install <tt class="docutils literal"><span class="pre">ejs</span></tt> locally with <tt class="docutils literal"><span class="pre">npm</span></tt> so that the EJS rendering engine is
installed in the <tt class="docutils literal"><span class="pre">node_modules</span></tt> directory as seen below:</p>
<div class="highlight-javascript"><pre>{app_dir}/node_modules
└── ejs
    ├── History.md
    ├── Makefile
    ├── Readme.md
    ├── benchmark.js
    ├── ejs.js
    ├── ejs.min.js
    ├── examples
    ├── index.js
    ├── lib
    ├── package.json
    ├── support
    └── test</pre>
</div>
</div>
<div class="section" id="ve-engine-ex-ejs-addon">
<span id="id7"></span><h5>View Engine Addon<a class="headerlink" href="#ve-engine-ex-ejs-addon" title="Permalink to this headline">¶</a></h5>
<p><tt class="docutils literal"><span class="pre">{app_dir}/addons/view-engines/ejs.server.js</span></tt></p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;addons-viewengine-ejs&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">NAME</span><span class="p">)</span> <span class="p">{</span>

  <span class="kd">var</span> <span class="nx">ejs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;ejs&#39;</span><span class="p">),</span>
  <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>
  <span class="kd">function</span> <span class="nx">EjsAdapter</span><span class="p">(</span><span class="nx">viewId</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewId</span> <span class="o">=</span> <span class="nx">viewId</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">EjsAdapter</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>

    <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">mojitType</span><span class="p">,</span> <span class="nx">tmpl</span><span class="p">,</span> <span class="nx">adapter</span><span class="p">,</span> <span class="nx">meta</span><span class="p">,</span> <span class="nx">more</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">me</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
      <span class="nx">handleRender</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">output</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">output</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">adapter</span><span class="p">.</span><span class="nx">flush</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="nx">meta</span><span class="p">);</span>
        <span class="p">});</span>
        <span class="nx">output</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">more</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">adapter</span><span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">meta</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">});</span>
      <span class="p">};</span>
      <span class="nx">Y</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Rendering template &quot;&#39;</span> <span class="o">+</span> <span class="nx">tmpl</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;mojito&#39;</span><span class="p">,</span> <span class="nx">NAME</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">ejs</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">compiler</span><span class="p">(</span><span class="nx">tmpl</span><span class="p">),</span><span class="nx">data</span><span class="p">);</span>
      <span class="nx">adapter</span><span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span><span class="nx">meta</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">compiler</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tmpl</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">tmpl</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="nx">Y</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s1">&#39;mojito.addons.viewEngines&#39;</span><span class="p">).</span><span class="nx">ejs</span> <span class="o">=</span> <span class="nx">EjsAdapter</span><span class="p">;</span>
<span class="p">},</span> <span class="s1">&#39;0.1.0&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">requires</span><span class="o">:</span> <span class="p">[]});</span>
</pre></div>
</div>
</div>
<div class="section" id="ve-engine-ex-ejs-template">
<span id="id8"></span><h5>Template<a class="headerlink" href="#ve-engine-ex-ejs-template" title="Permalink to this headline">¶</a></h5>
<p><tt class="docutils literal"><span class="pre">{app_dir}/mojits/{mojit_name}/views/foo.ejs.html</span></tt></p>
<div class="highlight-html"><pre>&lt;h2&gt; &lt;%= title %&gt;&lt;/h2&gt;
&lt;div id=&lt;%= mojit_view_id %&gt;&gt;
  &lt;h3&gt;&lt;%= ul.title %&gt;&lt;/h3&gt;
  &lt;ul&gt;
  &lt;% for(var i=0;i&lt;view_engines.length;i++){ %&gt;
    &lt;li&gt;&lt;%= view_engines[i] %&gt;&lt;/li&gt;
  &lt;% } %&gt;
  &lt;/ul&gt;
&lt;/div&gt;</pre>
</div>
</div>
</div>
</div>
</div>
</div>

   </div>

