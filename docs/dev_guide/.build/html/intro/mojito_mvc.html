

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
     <title>MVC in Mojito</title>
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '',
        COLLAPSE_INDEX: true,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/theme_extras.js"></script>
   </head> 

     <div class="header"><h1 class="heading"><a href="#">
          <span>Mojito</span></a></h1>
      </div>
      <div class="topnav">
        <p>
        <a class="uplink" href="../">Mojito Documentation</a>
        &#160;&#160;::&#160;&#160;
        <a href="../index.html" title="Mojito">Mojito</a>
        &#160;&#160;::&#160;&#160;
        
           <a href="mojito_mojits.html">Mojits</a>
        &#160;&#160;::&#160;&#160;
        
        
           <a href="mojito_configuring.html">Configuring Mojito</a>
        
        </p>

      </div>
      <div class="content">
   <div class="section" id="mvc-in-mojito">
<h1>MVC in Mojito<a class="headerlink" href="#mvc-in-mojito" title="Permalink to this headline">¶</a></h1>
<p>The MVC architecture in Mojito incorporates a clear separation of the
controller, model, and view. The controller is pivotal in the sense that it controls
all interactions in the MVC of Mojito.The controller retrieves data from the model
and passes it to the view. Client requests for data are sent to the controller,
which in turn fetches data from the model and passes the data to the client.</p>
<p>The controller, model, and view are found in the mojit of Mojito. The mojit
is a single unit of execution of a Mojito application. An application may
have one or more mojits, which are physically represented by a directory
structure. Each mojit has one controller, any number or no models, and one
or more views. When Mojito receives an HTTP request, an application invokes
a mojit controller that can then execute, pass data to the view, or get data
from the model. Let&#8217;s look now at each of the MVC components in more detail.</p>
<div class="section" id="models">
<span id="mojito-mvc-models"></span><h2>Models<a class="headerlink" href="#models" title="Permalink to this headline">¶</a></h2>
<p>Models are intended to closely represent business logic entities and contain code that
accesses and persists data. Mojito lets you create one or more models at the
application and mojit level that can be accessed from controllers.</p>
<div class="section" id="location">
<span id="mvc-models-loc"></span><h3>Location<a class="headerlink" href="#location" title="Permalink to this headline">¶</a></h3>
<p>Models are found in the <tt class="docutils literal"><span class="pre">models</span></tt> directory of each mojit. For the application
<tt class="docutils literal"><span class="pre">hello</span></tt> with the mojit <tt class="docutils literal"><span class="pre">HelloMojit</span></tt>, the path to the models would be
<tt class="docutils literal"><span class="pre">hello/mojits/HelloMojit/models</span></tt>.</p>
</div>
<div class="section" id="naming-convention">
<span id="mvc-models-naming"></span><h3>Naming Convention<a class="headerlink" href="#naming-convention" title="Permalink to this headline">¶</a></h3>
<p>The name of the model file depend on the affinity, which is the location
where a resource is available. Thus, the name of the model file is
<tt class="docutils literal"><span class="pre">{model_name}.{affinity}.js</span></tt>, where <tt class="docutils literal"><span class="pre">{affinity}</span></tt> can be <tt class="docutils literal"><span class="pre">common</span></tt>,
<tt class="docutils literal"><span class="pre">server</span></tt>, or <tt class="docutils literal"><span class="pre">client</span></tt>.</p>
<p>When adding the model as a module with <tt class="docutils literal"><span class="pre">YUI.add</span></tt>,  we suggest
you use the following syntax: <tt class="docutils literal"><span class="pre">{mojit_name}Model{Model_name}</span></tt></p>
<p>For the default model <tt class="docutils literal"><span class="pre">model.server.js</span></tt>, the suggested convention is
<tt class="docutils literal"><span class="pre">{mojit_name}Model</span></tt> for the module name.</p>
<p>Thus, the <tt class="docutils literal"><span class="pre">YUI.add</span></tt> statement in <tt class="docutils literal"><span class="pre">photos/models/flickr.server.js</span></tt> would
be the following:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&quot;photosModelFlickr&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">NAME</span><span class="p">)</span> <span class="p">{</span>
   <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="basic-structure">
<span id="mvc-models-structure"></span><h3>Basic Structure<a class="headerlink" href="#basic-structure" title="Permalink to this headline">¶</a></h3>
<p>A model should have the basic structure shown below.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;{mojit_name}Model{Model_name}&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">NAME</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Models must register themselves with YUI.add</span>
  <span class="c1">// Namespace for models</span>
  <span class="nx">Y</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s1">&#39;mojito.models&#39;</span><span class="p">)[</span><span class="nx">NAME</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1">// Optional init() method is given the</span>
    <span class="c1">// mojit configuration information.</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">config</span> <span class="o">=</span> <span class="nx">config</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="c1">// Model methods ideally are asynchronous, and</span>
    <span class="c1">// thus need some way of notifying the caller</span>
    <span class="c1">// when the method is done.</span>
    <span class="nx">someMethod</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">foo</span><span class="p">,</span> <span class="nx">bar</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// ... get some data ...</span>
      <span class="nx">callback</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="c1">// The requires array list the YUI module dependencies</span>
<span class="p">},</span> <span class="s1">&#39;0.0.1&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">requires</span><span class="o">:</span><span class="p">[]</span> <span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="model-objects-and-methods">
<span id="mvc-models-objs"></span><h3>Model Objects and Methods<a class="headerlink" href="#model-objects-and-methods" title="Permalink to this headline">¶</a></h3>
<p>The following objects and methods form the backbone of the model.</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">YUI.add</span></tt> - (required) adds the module</li>
<li><tt class="docutils literal"><span class="pre">Y.namespace('mojito.models')[NAME]</span></tt> - (required) registers the model</li>
<li><tt class="docutils literal"><span class="pre">init</span></tt> - (optional) gets configuration information</li>
</ul>
<p>The example model below shows you how the objects and methods are used. The
<tt class="docutils literal"><span class="pre">galleryModelFlickr</span></tt> model is registered with <tt class="docutils literal"><span class="pre">YUI.add</span></tt>, and the namespace
for the model is created with <tt class="docutils literal"><span class="pre">Y.namespace('mojito.models')[NAME]</span></tt>. The
<tt class="docutils literal"><span class="pre">init</span></tt> function stores the date so it can be used by other functions, and
the <tt class="docutils literal"><span class="pre">requires</span></tt> array instructs Mojito to load the YUI module <tt class="docutils literal"><span class="pre">yql</span></tt> for
getting data.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;galleryModelFlickr&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">NAME</span><span class="p">)</span> <span class="p">{</span>

  <span class="c1">// Models must register themselves in the</span>
  <span class="c1">// Namespace for model</span>
  <span class="nx">Y</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s1">&#39;mojito.models&#39;</span><span class="p">)[</span><span class="nx">NAME</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1">// Optional init() method is given the mojit</span>
    <span class="c1">// configuration information.</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">config</span> <span class="o">=</span> <span class="nx">config</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="c1">// Model function to get data</span>
    <span class="nx">get_photos</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">flickr_query</span><span class="p">,</span> <span class="nx">callback</span><span class="p">){</span>
      <span class="nx">Y</span><span class="p">.</span><span class="nx">YQL</span> <span class="p">(</span><span class="nx">flickr_query</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">rawYql</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Handle empty response.</span>
        <span class="k">if</span> <span class="p">(</span><span class="kc">null</span> <span class="o">==</span> <span class="nx">rawYql</span> <span class="o">||</span> <span class="mi">0</span> <span class="o">==</span> <span class="nx">rawYql</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">count</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">callback</span> <span class="p">([]);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">callback</span><span class="p">(</span><span class="nx">rawYql</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">results</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">},</span> <span class="s1">&#39;0.0.1&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">requires</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;yql&#39;</span><span class="p">]});</span>
</pre></div>
</div>
</div>
<div class="section" id="using-models">
<span id="mvc-models-using"></span><h3>Using Models<a class="headerlink" href="#using-models" title="Permalink to this headline">¶</a></h3>
<p>The function of the model is to get information and send it to the controller.
When calling model functions from a mojit controller, a callback function must
be provided to allow for the model code to run long-term processes for data
storage and retrieval. As a matter of best practice, the model should be a YUI
module and not include blocking code, although blocking code can be used.</p>
<p>See <a class="reference internal" href="#mvc-controllers-call-model"><em>Calling the Model</em></a> to learn how
to call the model from the controller.</p>
</div>
<div class="section" id="example">
<span id="mvc-models-ex"></span><h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;weatherModelForecast&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">NAME</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Models must register themselves in the</span>
  <span class="c1">// Namespace for model</span>
  <span class="nx">Y</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s1">&#39;mojito.models&#39;</span><span class="p">)[</span><span class="nx">NAME</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1">// Optional init() method is given the mojit</span>
    <span class="c1">// configuration information.</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">config</span> <span class="o">=</span> <span class="nx">config</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="cm">/**</span>
<span class="cm">    * Method that will be invoked by the</span>
<span class="cm">    * mojit controller to obtain data.</span>
<span class="cm">    * @param callback {Function} The callback</span>
<span class="cm">    * function to call when the data has been retrieved.</span>
<span class="cm">    */</span>
    <span class="nx">forecast</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">zip_code</span><span class="p">,</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">zip</span> <span class="o">=</span> <span class="nx">zip_code</span> <span class="o">||</span> <span class="s2">&quot;94040&quot;</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="s2">&quot;select * from weather.forecast where location=&quot;</span> <span class="o">+</span> <span class="nx">zip</span><span class="p">;</span>
      <span class="nx">Y</span><span class="p">.</span><span class="nx">YQL</span> <span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">rawYql</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Handle empty response.</span>
        <span class="k">if</span> <span class="p">(</span><span class="kc">null</span> <span class="o">==</span> <span class="nx">rawYql</span> <span class="o">||</span> <span class="mi">0</span> <span class="o">==</span> <span class="nx">rawYql</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">count</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">callback</span> <span class="p">([]);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">callback</span><span class="p">({</span> <span class="s2">&quot;link&quot;</span><span class="o">:</span> <span class="nx">rawYql</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">results</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">link</span><span class="p">});</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">},</span> <span class="s1">&#39;0.0.1&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">requires</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;yql&#39;</span><span class="p">]});</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="controllers">
<span id="mojito-mvc-controllers"></span><h2>Controllers<a class="headerlink" href="#controllers" title="Permalink to this headline">¶</a></h2>
<p>After an application has been configured to use a mojit, the mojit controller can either
do all of the work or delegate the work to models and/or views. In the typical case, the
mojit controller requests the model to retrieve data and then the controller serves that
data to the views.</p>
<div class="section" id="id1">
<h3>Location<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Controllers are found in the mojit directory. For the application
<tt class="docutils literal"><span class="pre">hello</span></tt> with the mojit <tt class="docutils literal"><span class="pre">HelloMojit</span></tt>, the path to the controller would be
<tt class="docutils literal"><span class="pre">hello/mojits/HelloMojit/controller.server.js</span></tt>.</p>
</div>
<div class="section" id="mvc-controllers-naming">
<span id="id2"></span><h3>Naming Convention<a class="headerlink" href="#mvc-controllers-naming" title="Permalink to this headline">¶</a></h3>
<div class="section" id="files">
<span id="controllers-naming-files"></span><h4>Files<a class="headerlink" href="#files" title="Permalink to this headline">¶</a></h4>
<p>A mojit can only use one controller, but may have a different controller for each
environment (client vs server). The name of the mojit controllers uses the syntax
<tt class="docutils literal"><span class="pre">controller.{affinity}.js</span></tt>, where the value can be <tt class="docutils literal"><span class="pre">common</span></tt>, <tt class="docutils literal"><span class="pre">server</span></tt>, or
<tt class="docutils literal"><span class="pre">client</span></tt>. The affinity is simply the location of the resource, which is important
because code can be deployed to the client.</p>
</div>
<div class="section" id="yui-module">
<span id="controllers-naming-yui-mod"></span><h4>YUI Module<a class="headerlink" href="#yui-module" title="Permalink to this headline">¶</a></h4>
<p>When registering the controller as a module with <tt class="docutils literal"><span class="pre">YUI.add</span></tt> in the controller,
you need to use the mojit name, which is also the same as the mojit directory
name: <tt class="docutils literal"><span class="pre">YUI.add({mojit_name},</span> <span class="pre">...);</span></tt></p>
<p>Thus, the <tt class="docutils literal"><span class="pre">YUI.add</span></tt> statement in <tt class="docutils literal"><span class="pre">mojits/flickr/controller.server.js</span></tt> would
be the following:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&quot;flickr&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">NAME</span><span class="p">)</span> <span class="p">{</span>
   <span class="p">...</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="mvc-controllers-structure">
<span id="id3"></span><h3>Basic Structure<a class="headerlink" href="#mvc-controllers-structure" title="Permalink to this headline">¶</a></h3>
<p>A controller should have the basic structure shown below.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;{mojit_name}&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">NAME</span><span class="p">)</span>
  <span class="c1">// Module name is {mojit-name}</span>
  <span class="c1">// Constructor for the Controller class.</span>
  <span class="nx">Y</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s1">&#39;mojito.controllers&#39;</span><span class="p">)[</span><span class="nx">NAME</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">    * Method corresponding to the &#39;index&#39; action.</span>
<span class="cm">    * @param ac {Object} The ActionContext object</span>
<span class="cm">    * that provides access to the Mojito API.</span>
<span class="cm">    */</span>
    <span class="nx">index</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ac</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">ac</span><span class="p">.</span><span class="nx">done</span><span class="p">({</span><span class="nx">data</span><span class="o">:</span> <span class="s2">&quot;Here is a string&quot;</span><span class="p">});</span>
    <span class="p">},</span>
    <span class="c1">// Other controller functions</span>
    <span class="nx">someFunction</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ac</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">ac</span><span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">);</span>
    <span class="p">},</span>
  <span class="p">};</span>
  <span class="c1">// The requires array lists the YUI module dependencies</span>
<span class="p">},</span> <span class="s1">&#39;0.0.1&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">requires</span><span class="o">:</span> <span class="p">[]});</span>
</pre></div>
</div>
</div>
<div class="section" id="controller-objects-and-methods">
<span id="mvc-controllers-objs"></span><h3>Controller Objects and Methods<a class="headerlink" href="#controller-objects-and-methods" title="Permalink to this headline">¶</a></h3>
<p>Several objects and methods form the backbone of the controller.</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">YUI.add</span></tt> - (required) registers the controller as a YUI module in the Mojito
framework.</li>
<li><tt class="docutils literal"><span class="pre">Y.namespace('mojito.controllers')[NAME]</span></tt> -  (required) creates a namespace
that makes functions available as Mojito actions.</li>
<li><tt class="docutils literal"><span class="pre">this</span></tt> - a reference pointing to an instance of the controller that the
function is running within. This means that you can refer to other functions
described within <tt class="docutils literal"><span class="pre">Y.namespace('mojito.controllers')[NAME]</span></tt> using
<tt class="docutils literal"><span class="pre">this.otherFunction</span></tt>. This is helpful when you&#8217;ve added some utility functions
onto your controller that do not accept an <tt class="docutils literal"><span class="pre">ActionContext</span></tt> object.</li>
<li><tt class="docutils literal"><span class="pre">requires</span></tt> - (optional) an array that lists any addons that are needed
by the controller.</li>
</ul>
</div>
<div class="section" id="mvc-controller-ex">
<span id="id4"></span><h3>Example<a class="headerlink" href="#mvc-controller-ex" title="Permalink to this headline">¶</a></h3>
<p>The example controller below shows you how the components are used. The
<tt class="docutils literal"><span class="pre">status</span></tt> mojit is registered with <tt class="docutils literal"><span class="pre">YUI.add</span></tt>, and the <tt class="docutils literal"><span class="pre">index</span></tt> function
uses the <tt class="docutils literal"><span class="pre">this</span></tt> reference to call the function <tt class="docutils literal"><span class="pre">create_status</span></tt>. Lastly, the
<tt class="docutils literal"><span class="pre">requires</span></tt> array loads the addons <tt class="docutils literal"><span class="pre">Intl</span></tt>, <tt class="docutils literal"><span class="pre">Params</span></tt>, and <tt class="docutils literal"><span class="pre">Url</span></tt> that are
needed by the controller.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">NAME</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">Y</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s1">&#39;mojito.controllers&#39;</span><span class="p">)[</span><span class="nx">NAME</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

    <span class="nx">index</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ac</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">dateString</span> <span class="o">=</span> <span class="nx">ac</span><span class="p">.</span><span class="nx">intl</span><span class="p">.</span><span class="nx">formatDate</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">());</span>
      <span class="kd">var</span> <span class="nx">status</span> <span class="o">=</span> <span class="nx">ac</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">getFromMerged</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">ac</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">getFromMerged</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">status</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">greeting</span><span class="o">:</span> <span class="nx">ac</span><span class="p">.</span><span class="nx">intl</span><span class="p">.</span><span class="nx">lang</span><span class="p">(</span><span class="s2">&quot;TITLE&quot;</span><span class="p">),</span>
        <span class="nx">url</span><span class="o">:</span> <span class="nx">ac</span><span class="p">.</span><span class="nx">url</span><span class="p">.</span><span class="nx">make</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span><span class="s1">&#39;index&#39;</span><span class="p">),</span>
        <span class="nx">status</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">create_status</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span><span class="nx">status</span><span class="p">,</span> <span class="nx">dateString</span><span class="p">)</span>
      <span class="p">};</span>
      <span class="nx">ac</span><span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">create_status</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">time</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">user</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span>  <span class="nx">status</span> <span class="o">+</span> <span class="s1">&#39; - &#39;</span> <span class="o">+</span> <span class="nx">time</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">},</span> <span class="s1">&#39;0.0.1&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">requires</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;mojito-intl-addon&#39;</span><span class="p">,</span> <span class="s1">&#39;mojito-params-addon&#39;</span><span class="p">,</span> <span class="s1">&#39;mojito-url-addon&#39;</span><span class="p">]});</span>
</pre></div>
</div>
</div>
<div class="section" id="controller-functions-as-mojito-actions">
<span id="mvc-controllers-actions"></span><h3>Controller Functions as Mojito Actions<a class="headerlink" href="#controller-functions-as-mojito-actions" title="Permalink to this headline">¶</a></h3>
<p>When mojit instances are created in the application configuration file, you
can then call controller functions as actions that are mapped to route paths.</p>
<p>In the application configure file <tt class="docutils literal"><span class="pre">application.json</span></tt> below, the mojit instance
<tt class="docutils literal"><span class="pre">hello</span></tt> is created.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;master&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;appPort&quot;</span><span class="o">:</span> <span class="mi">8666</span><span class="p">,</span>
    <span class="s2">&quot;specs&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;hello&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;HelloMojit&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>The controller for the <tt class="docutils literal"><span class="pre">HelloMojit</span></tt> mojit has an <tt class="docutils literal"><span class="pre">index</span></tt> function that we
want to call when an HTTP GET call is made on the root path. To do this, the
route configuration file <tt class="docutils literal"><span class="pre">routes.json</span></tt> maps the <tt class="docutils literal"><span class="pre">hello</span></tt> instance and the
<tt class="docutils literal"><span class="pre">index</span></tt> action to the root path with the <tt class="docutils literal"><span class="pre">path</span></tt> and <tt class="docutils literal"><span class="pre">call</span></tt> properties
as seen below.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;master&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;hello index&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;path&quot;</span><span class="o">:</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
      <span class="s2">&quot;call&quot;</span><span class="o">:</span> <span class="s2">&quot;hello.index&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>In the controller, any function that is defined in the
<tt class="docutils literal"><span class="pre">Y.namespace('mojito.controllers')[NAME]</span></tt> is available as a Mojito action.
These functions can only accept the <tt class="docutils literal"><span class="pre">ActionContext</span></tt> object as an argument.
In the example controller below, the <tt class="docutils literal"><span class="pre">index</span></tt> and <tt class="docutils literal"><span class="pre">greeting</span></tt> functions
are available as Mojito actions.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;Stateful&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">NAME</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">Y</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s1">&#39;mojito.controllers&#39;</span><span class="p">)[</span><span class="nx">NAME</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

    <span class="nx">index</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ac</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">ac</span><span class="p">.</span><span class="nx">done</span><span class="p">({</span><span class="nx">id</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">id</span><span class="p">});</span>
    <span class="p">},</span>
    <span class="nx">greeting</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ac</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">ac</span><span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">);</span>
    <span class="p">},</span>
  <span class="p">};</span>
  <span class="c1">// The requires array list the YUI module dependencies</span>
<span class="p">},</span> <span class="s1">&#39;0.0.1&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">requires</span><span class="o">:</span> <span class="p">[]});</span>
</pre></div>
</div>
</div>
<div class="section" id="calling-the-model">
<span id="mvc-controllers-call-model"></span><h3>Calling the Model<a class="headerlink" href="#calling-the-model" title="Permalink to this headline">¶</a></h3>
<p>The mojit controller communicates with the model through the
<a class="reference external" href="../api_overview/mojito_action_context.html">ActionContext object</a> and a
syntax convention. The <tt class="docutils literal"><span class="pre">ActionContext</span></tt> object allows controller functions
to access framework features such as API methods and addons that extend
functionality. To access the model from the ActionContext object <tt class="docutils literal"><span class="pre">ac</span></tt>,
you use the following syntax: <tt class="docutils literal"><span class="pre">ac.models.get('{model_name}').{model_function}</span></tt>
You also need to require the <tt class="docutils literal"><span class="pre">Models</span></tt> addon by adding the string
<tt class="docutils literal"><span class="pre">&quot;mojito-models-addon&quot;</span></tt> to the <tt class="docutils literal"><span class="pre">requires</span></tt> array.</p>
<p>The <tt class="docutils literal"><span class="pre">{model_name}</span></tt> is the YUI module name that is passed to <tt class="docutils literal"><span class="pre">YUI.add</span></tt> of the
model file, not the model file name. The example controller below shows the
syntax for calling the model from a controller.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;{mojit_name}&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">NAME</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">Y</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s1">&#39;mojito.controllers&#39;</span><span class="p">)[</span><span class="nx">NAME</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">index</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ac</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">model</span> <span class="o">=</span> <span class="nx">ac</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;{model_name}&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">},</span> <span class="s1">&#39;0.0.1&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">requires</span><span class="o">:</span><span class="p">[</span>
  <span class="s1">&#39;mojito-models-addon&#39;</span><span class="p">,</span>
  <span class="s1">&#39;{model_name}&#39;</span>
<span class="p">]});</span>
</pre></div>
</div>
<p>For example, if you wanted to use the <tt class="docutils literal"><span class="pre">photo_search</span></tt> function in the model for the
<tt class="docutils literal"><span class="pre">flickr</span></tt> mojit, you would use the following: <tt class="docutils literal"><span class="pre">ac.models.get('flickr').photo_search(args,</span> <span class="pre">callback);</span></tt></p>
<p>The <tt class="docutils literal"><span class="pre">controller.server.js</span></tt> below shows a simple example of calling
<tt class="docutils literal"><span class="pre">get_data</span></tt> from the model <tt class="docutils literal"><span class="pre">simpleModel</span></tt>.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;simple&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">NAME</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">Y</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s1">&#39;mojito.controllers&#39;</span><span class="p">)[</span><span class="nx">NAME</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

    <span class="nx">index</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ac</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">model</span> <span class="o">=</span> <span class="nx">ac</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;simpleModel&#39;</span><span class="p">);</span>
      <span class="nx">model</span><span class="p">.</span><span class="nx">get_data</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ac</span><span class="p">.</span><span class="nx">done</span> <span class="p">(</span>
          <span class="p">{</span>
            <span class="nx">simple_data</span><span class="o">:</span> <span class="nx">data</span>
          <span class="p">}</span>
        <span class="p">)</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">},</span> <span class="s1">&#39;0.0.1&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">requires</span><span class="o">:</span> <span class="p">[</span>
  <span class="s1">&#39;mojito-models-addon&#39;</span><span class="p">,</span>
  <span class="s1">&#39;simpleModel&#39;</span>
<span class="p">]});</span>
</pre></div>
</div>
<p>For a more detailed example, see <a class="reference internal" href="#calling-the-model">Calling the Model</a> and
<a class="reference external" href="../code_exs/calling_yql.html">Calling YQL from a Mojit</a>.</p>
</div>
<div class="section" id="passing-data-to-the-view">
<span id="mvc-controllers-pass-data"></span><h3>Passing Data to the View<a class="headerlink" href="#passing-data-to-the-view" title="Permalink to this headline">¶</a></h3>
<p>The controller also uses the <tt class="docutils literal"><span class="pre">ActionContext</span></tt> object to send data to the view.
Calling the <tt class="docutils literal"><span class="pre">done</span></tt> method from the <tt class="docutils literal"><span class="pre">ActionContext</span></tt> object, you can send literal
strings or objects, with the latter being interpolated in template tags that are
rendered by the appropriate view engine. The <tt class="docutils literal"><span class="pre">done</span></tt> method should only be
called once. If neither <tt class="docutils literal"><span class="pre">done</span></tt> nor <tt class="docutils literal"><span class="pre">error</span></tt> is called within 60 seconds, Mojito
will log a warning and invoke <tt class="docutils literal"><span class="pre">error</span></tt> with a Timeout error.
You can change the default timeout value of 60000ms (60 seconds) by setting the
<tt class="docutils literal"><span class="pre">actionTimeout</span></tt> property of your application configuration.</p>
<p>In the example <tt class="docutils literal"><span class="pre">controller.server.js</span></tt> below, the <tt class="docutils literal"><span class="pre">index</span></tt> function sends the <tt class="docutils literal"><span class="pre">user</span></tt>
object to the <tt class="docutils literal"><span class="pre">index</span></tt> template.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;UserMojit&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">NAME</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/**</span>
<span class="cm">  * The HelloMojit module.</span>
<span class="cm">  * @module HelloMojit</span>
<span class="cm">  */</span>
  <span class="cm">/**</span>
<span class="cm">  * Constructor for the Controller class.</span>
<span class="cm">  * @class Controller</span>
<span class="cm">  * @constructor</span>
<span class="cm">  */</span>
  <span class="nx">Y</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s1">&#39;mojito.controllers&#39;</span><span class="p">)[</span><span class="nx">NAME</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">    * Method corresponding to the &#39;index&#39; action.</span>
<span class="cm">    * @param ac {Object} The action context that</span>
<span class="cm">    * provides access to the Mojito API.</span>
<span class="cm">    */</span>
    <span class="nx">index</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ac</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="o">:</span> <span class="mi">34</span> <span class="p">}</span>
      <span class="nx">ac</span><span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">},</span> <span class="s1">&#39;0.0.1&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">requires</span><span class="o">:</span> <span class="p">[]});</span>
</pre></div>
</div>
</div>
<div class="section" id="specifying-the-view">
<span id="mvc-controllers-specify-view"></span><h3>Specifying the View<a class="headerlink" href="#specifying-the-view" title="Permalink to this headline">¶</a></h3>
<p>The default behavior when you pass data from the controller to the view is for
the data to be passed to the view that has the same name as the controller
function. For example, if <tt class="docutils literal"><span class="pre">ac.done({</span> <span class="pre">&quot;title&quot;:</span> <span class="pre">&quot;Default</span> <span class="pre">View&quot;</span> <span class="pre">})</span></tt> is invoked
in the controller <tt class="docutils literal"><span class="pre">index</span></tt> function, the data is sent by default to the
<tt class="docutils literal"><span class="pre">index</span></tt> template. The <tt class="docutils literal"><span class="pre">index</span></tt> template could be <tt class="docutils literal"><span class="pre">index.hb.html</span></tt>,
<tt class="docutils literal"><span class="pre">index.iphone.hb.html</span></tt>, etc., depending on the calling device and
rendering engine.</p>
<p>To specify the view that receives the data, the controller function passes two
parameters to <tt class="docutils literal"><span class="pre">ac.done</span></tt>: The first parameter is the data, and the second
parameter specifies the view name. In the example controller below, the
<tt class="docutils literal"><span class="pre">user</span></tt> function passes the <tt class="docutils literal"><span class="pre">data</span></tt> object to the <tt class="docutils literal"><span class="pre">profile</span></tt> template
instead of the default <tt class="docutils literal"><span class="pre">user</span></tt> template.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;UserMojit&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">NAME</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/**</span>
<span class="cm">  * The HelloMojit module.</span>
<span class="cm">  * @module HelloMojit</span>
<span class="cm">  */</span>
  <span class="cm">/**</span>
<span class="cm">  * Constructor for the Controller class.</span>
<span class="cm">  * @class Controller</span>
<span class="cm">  * @constructor</span>
<span class="cm">  */</span>
  <span class="nx">Y</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s1">&#39;mojito.controllers&#39;</span><span class="p">)[</span><span class="nx">NAME</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">    * Method corresponding to the &#39;index&#39; action.</span>
<span class="cm">    * @param ac {Object} The action context that</span>
<span class="cm">    * provides access to the Mojito API.</span>
<span class="cm">    */</span>
    <span class="nx">index</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ac</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;title&quot;</span><span class="o">:</span> <span class="s2">&quot;Going to default template.&quot;</span> <span class="p">}</span>
      <span class="nx">ac</span><span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">user</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ac</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;title&quot;</span><span class="o">:</span> <span class="s2">&quot;Going to profile template.&quot;</span> <span class="p">}</span>
      <span class="nx">ac</span><span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="s2">&quot;profile&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">},</span> <span class="s1">&#39;0.0.1&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">requires</span><span class="o">:</span> <span class="p">[]});</span>
</pre></div>
</div>
</div>
<div class="section" id="reporting-errors">
<span id="mvc-controllers-report-error"></span><h3>Reporting Errors<a class="headerlink" href="#reporting-errors" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">ActionContext</span></tt> object has an <tt class="docutils literal"><span class="pre">error</span></tt> method for reporting errors.
Like the <tt class="docutils literal"><span class="pre">done</span></tt> method, <tt class="docutils literal"><span class="pre">error</span></tt> should only be called once. Also, you
cannot call both <tt class="docutils literal"><span class="pre">done</span></tt> and <tt class="docutils literal"><span class="pre">error</span></tt>. The error requires an <tt class="docutils literal"><span class="pre">Error</span></tt>
object as a parameter. The <tt class="docutils literal"><span class="pre">Error</span></tt> object is just the standard JavaScript
<tt class="docutils literal"><span class="pre">Error</span></tt> object that can have a <tt class="docutils literal"><span class="pre">code</span></tt> property specifying the HTTP response
code that will be used if the error bubbles to the top of the
page (i.e., not caught by a parent mojit).</p>
<p>In the code snippet below from <tt class="docutils literal"><span class="pre">controller.server.js</span></tt>, the <tt class="docutils literal"><span class="pre">index</span></tt>
method uses the query string parameter <tt class="docutils literal"><span class="pre">company</span></tt> to fetch company information
stored in a configuration file. The <tt class="docutils literal"><span class="pre">if-else</span></tt> clause either sends
the company information to the <tt class="docutils literal"><span class="pre">index</span></tt> template or reports
an error that information for the specified company could not be found.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">...</span>
  <span class="nx">index</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ac</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">company</span>  <span class="o">=</span> <span class="nx">ac</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">url</span><span class="p">(</span><span class="s1">&#39;company&#39;</span><span class="p">),</span>
        <span class="nx">company_info</span> <span class="o">=</span> <span class="nx">ac</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">company</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">company_info</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">ac</span><span class="p">.</span><span class="nx">done</span><span class="p">({</span> <span class="s2">&quot;company_info&quot;</span><span class="o">:</span> <span class="nx">company_info</span> <span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">ac</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Could not find info for &quot;</span> <span class="o">+</span> <span class="nx">company</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">...</span>
<span class="p">},</span> <span class="s1">&#39;0.0.1&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">requires</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;mojito-params-addon&#39;</span><span class="p">,</span> <span class="s1">&#39;mojito-config-addon&#39;</span><span class="p">]});</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="views">
<span id="mojito-mvc-views"></span><span id="mvc-controllers-save-state"></span><h2>Views<a class="headerlink" href="#views" title="Permalink to this headline">¶</a></h2>
<p>The views are HTML files that can include templates, such as Handlebars
expressions, and are located in the <tt class="docutils literal"><span class="pre">views</span></tt> directory. We call these
files <em>templates</em> to differentiate them from the rendered views that
have substituted values for the template tags. Mojito uses
<a class="reference external" href="http://handlebarsjs.com/">Handlebars</a> as the default rendering engine
for templates.</p>
<div class="section" id="mvc-views-naming">
<span id="id5"></span><h3>Naming Convention<a class="headerlink" href="#mvc-views-naming" title="Permalink to this headline">¶</a></h3>
<p>Template files have the following naming convention:</p>
<p><tt class="docutils literal"><span class="pre">{controller_function}.[{selector}].{rendering_engine}.html</span></tt></p>
<p>The following list describes the elements of the template file name:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">{controller_function}</span></tt> - the controller function (action)
that supplies data. Controller functions can also specify different
templates.</li>
<li><tt class="docutils literal"><span class="pre">{selector}</span></tt> - an arbitrary  string used to select
a specific template. For example, you could use the selector
<tt class="docutils literal"><span class="pre">iphone</span></tt> for the iPhone template.</li>
<li><tt class="docutils literal"><span class="pre">{rendering_engine}</span></tt> - the engine that renders the templates.</li>
</ul>
<p>For example, if the template is receiving data from the <tt class="docutils literal"><span class="pre">index</span></tt> function
of the controller and has Handlebars expressions that need to be rendered,
the name of the template would be <tt class="docutils literal"><span class="pre">index.hb.html</span></tt>.</p>
<p>Here are some other example template names with descriptions:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">greeting.hb.html</span></tt> - This template gets data from the <tt class="docutils literal"><span class="pre">greeting</span></tt>
function of the controller and the calling device is determined to
be a Web browser.</li>
<li><tt class="docutils literal"><span class="pre">get_photos.iphone.hb.html</span></tt> - This template gets data from the
<tt class="docutils literal"><span class="pre">get_photos</span></tt> function of the controller and the calling device is an iPhone.</li>
<li><tt class="docutils literal"><span class="pre">find_friend.android.hb.html</span></tt> - This template gets data from the
<tt class="docutils literal"><span class="pre">find_friend</span></tt> function of the controller and the calling device is Android
based.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Currently, Mojito comes with Handlebars, so the name of templates
always contains <tt class="docutils literal"><span class="pre">hb</span></tt>. Users can use other
<a class="reference external" href="../topics/mojito_extensions.html#view-engines">view engines</a>,
but the <tt class="docutils literal"><span class="pre">{rendering_engine}</span></tt> component of the template name must
change. An error will occur if the file names of different views
are the same except the <tt class="docutils literal"><span class="pre">{rendering_engine}</span></tt>. For example, having
the two templates <tt class="docutils literal"><span class="pre">index.hb.html</span></tt> and <tt class="docutils literal"><span class="pre">index.ejs.html</span></tt> (<tt class="docutils literal"><span class="pre">ejs</span></tt>
could be <a class="reference external" href="http://embeddedjs.com/">Embedded JavaScript (EJS)</a>) would
cause an error.</p>
</div>
</div>
<div class="section" id="supported-devices">
<span id="mvc-views-supported-devices"></span><h3>Supported Devices<a class="headerlink" href="#supported-devices" title="Permalink to this headline">¶</a></h3>
<p>Mojito can examine the HTTP header <tt class="docutils literal"><span class="pre">User</span> <span class="pre">Agent</span></tt> and detect the following
devices/browsers:</p>
<table border="1" class="docutils">
<colgroup>
<col width="39%" />
<col width="61%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Device/Browser</th>
<th class="head">Example Template</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Opera Mini</td>
<td>index.opera-mini.hb.html</td>
</tr>
<tr class="row-odd"><td>iPhone</td>
<td>index.iphone.hb.html</td>
</tr>
<tr class="row-even"><td>iPad</td>
<td>index.ipad.hb.html</td>
</tr>
<tr class="row-odd"><td>Android</td>
<td>index.android.hb.html</td>
</tr>
<tr class="row-even"><td>Windows Mobile</td>
<td>index.iemobile.hb.html</td>
</tr>
<tr class="row-odd"><td>Palm</td>
<td>index.palm.hb.html</td>
</tr>
<tr class="row-even"><td>Kindle</td>
<td>index.kindle.hb.html</td>
</tr>
<tr class="row-odd"><td>Blackberry</td>
<td>index.blackberry.hb.html</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="using-handlebars-expressions">
<span id="mvc-views-using-hb"></span><h3>Using Handlebars Expressions<a class="headerlink" href="#using-handlebars-expressions" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference external" href="../topics/mojito_hb_templates.html">Handlebars in Mojito</a> for more
information.</p>
</div>
<div class="section" id="using-mustache-tags">
<span id="mvc-views-using-mustache"></span><h3>Using Mustache Tags<a class="headerlink" href="#using-mustache-tags" title="Permalink to this headline">¶</a></h3>
<p>Mojito uses Handlebars to render Mustache tags, so if you are creating
templates using Mustache tags and specify <tt class="docutils literal"><span class="pre">mu</span></tt> in the file name, such as
the template <tt class="docutils literal"><span class="pre">index.mu.html</span></tt>, the template will be rendered by Handlebars.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If a controller has added logic to ensure the safe encoding of Mustache
tags, you may need to remove that logic from the controller and rename your
template to specify Handlebars (i.e., <tt class="docutils literal"><span class="pre">{controller_function}.hb.html</span></tt>),
or you can use triple brackets <tt class="docutils literal"><span class="pre">{{{}}}</span></tt> instead to avoid the default
encoding done by Handlebars.</p>
</div>
</div>
<div class="section" id="mojito-supplied-data">
<span id="mvc-views-supplied-data"></span><h3>Mojito-Supplied Data<a class="headerlink" href="#mojito-supplied-data" title="Permalink to this headline">¶</a></h3>
<p>Mojito supplies the following data that can be accessed as template tags in the
template:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">{{mojit_view_id}}</span></tt> - a unique ID for the view being rendered. We recommend
that this tag be used as the value for the <tt class="docutils literal"><span class="pre">id</span></tt> attribute of the a top-level
element (i.e., <tt class="docutils literal"><span class="pre">&lt;div&gt;</span></tt>) of your template because it is used to bind the
binders to the DOM of the view.</li>
<li><tt class="docutils literal"><span class="pre">{{mojit_assets}}</span></tt> - the partial URL to the <tt class="docutils literal"><span class="pre">assets</span></tt> directory of your
mojit. You can use the value of this tag to point to specific assets. For
example, if your mojit has the image <tt class="docutils literal"><span class="pre">assets/spinner.gif</span></tt>, then you can
point to this image in your template with the following:
<tt class="docutils literal"><span class="pre">&lt;img</span> <span class="pre">src=&quot;{{mojit_assets}}/spinner.gif&quot;&gt;</span></tt></li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The prefix <tt class="docutils literal"><span class="pre">mojit_</span></tt> is reserved for use by Mojito, and thus,
user-defined variables cannot use this prefix in their names.</p>
</div>
</div>
<div class="section" id="examples">
<span id="mvc-views-exs"></span><h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference external" href="../code_exs/#views">Code Examples: Views</a> for annotated code examples,
steps to run code, and source code for Mojito applications.</p>
</div>
</div>
</div>

   </div>

